<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Tools</title>
    <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
    <script src="https://unpkg.com/turndown-plugin-gfm/dist/turndown-plugin-gfm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .subtitle {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 0;
            font-size: 0.95rem;
        }

        .header-row {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-bottom: 20px;
        }

        .header-content {
            text-align: center;
        }

        .about-author-btn {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .about-author-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        @media (max-width: 700px) {
            .header-row {
                flex-direction: column;
                gap: 15px;
            }
            .about-author-btn {
                position: static;
                transform: none;
            }
        }

        .mode-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-tab {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .mode-tab:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .mode-tab.active {
            background: white;
            color: #667eea;
            font-weight: 600;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .panel-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-weight: 600;
            color: #333;
        }

        .panel-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd6;
        }

        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }

        .btn-secondary:hover {
            background: #dee2e6;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .panel-body {
            padding: 0;
        }

        /* ÂØåÊñáÊú¨ËæìÂÖ•Âå∫Âüü */
        .rich-input {
            min-height: 400px;
            padding: 20px;
            outline: none;
            font-size: 1rem;
            line-height: 1.6;
            overflow-y: auto;
            max-height: 500px;
        }

        .rich-input:empty:before {
            content: attr(data-placeholder);
            color: #adb5bd;
        }

        .rich-input:focus {
            background: #fafbfc;
        }

        /* HTML ËæìÂÖ•Âå∫Âüü */
        .html-input {
            width: 100%;
            min-height: 400px;
            max-height: 500px;
            padding: 20px;
            border: none;
            outline: none;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            resize: none;
            background: #1e1e1e;
            color: #d4d4d4;
        }

        .html-input::placeholder {
            color: #6a6a6a;
        }

        /* Markdown ËæìÂá∫Âå∫Âüü */
        .markdown-output {
            width: 100%;
            min-height: 400px;
            max-height: 500px;
            padding: 20px;
            border: none;
            outline: none;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            resize: none;
            background: #fafbfc;
        }

        /* Markdown È¢ÑËßàÂå∫Âüü */
        .markdown-preview {
            width: 100%;
            min-height: 400px;
            max-height: 500px;
            padding: 20px;
            overflow-y: auto;
            background: #fff;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .markdown-preview h1 { font-size: 2em; margin: 0.67em 0; border-bottom: 1px solid #eee; padding-bottom: 0.3em; }
        .markdown-preview h2 { font-size: 1.5em; margin: 0.83em 0; border-bottom: 1px solid #eee; padding-bottom: 0.3em; }
        .markdown-preview h3 { font-size: 1.17em; margin: 1em 0; }
        .markdown-preview h4 { font-size: 1em; margin: 1.33em 0; }
        .markdown-preview p { margin: 1em 0; }
        .markdown-preview ul, .markdown-preview ol { margin: 1em 0; padding-left: 2em; }
        .markdown-preview li { margin: 0.5em 0; }
        .markdown-preview code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
        }
        .markdown-preview pre {
            background: #282c34;
            color: #abb2bf;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1em 0;
        }
        .markdown-preview pre code {
            background: none;
            padding: 0;
            color: inherit;
        }
        .markdown-preview blockquote {
            border-left: 4px solid #ddd;
            padding-left: 16px;
            margin: 1em 0;
            color: #666;
        }
        .markdown-preview table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
        }
        .markdown-preview th, .markdown-preview td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: left;
        }
        .markdown-preview th {
            background: #f4f4f4;
            font-weight: 600;
        }
        .markdown-preview img {
            max-width: 100%;
            height: auto;
        }
        .markdown-preview a {
            color: #0366d6;
            text-decoration: none;
        }
        .markdown-preview a:hover {
            text-decoration: underline;
        }
        .markdown-preview hr {
            border: none;
            border-top: 1px solid #eee;
            margin: 2em 0;
        }

        /* ËæìÂá∫Ê®°ÂºèÂàáÊç¢Ê†áÁ≠æ */
        .output-tabs {
            display: flex;
            gap: 0;
            margin-left: 15px;
        }

        .output-tab {
            padding: 6px 14px;
            border: none;
            background: rgba(0, 0, 0, 0.05);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
            color: #666;
        }

        .output-tab:first-child {
            border-radius: 4px 0 0 4px;
        }

        .output-tab:last-child {
            border-radius: 0 4px 4px 0;
        }

        .output-tab.active {
            background: #4CAF50;
            color: white;
        }

        .output-tab:hover:not(.active) {
            background: rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none !important;
        }

        /* Toast ÊèêÁ§∫ */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* ÈÄâÈ°πËÆæÁΩÆ */
        .options {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .option-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .option-item select {
            padding: 5px 10px;
            border-radius: 4px;
            border: none;
            font-size: 0.85rem;
        }

        /* ÊãñÊãΩÊèêÁ§∫ */
        .drop-hint {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(102, 126, 234, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            z-index: 10;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .drop-hint.show {
            opacity: 1;
        }

        .input-panel {
            position: relative;
        }

        /* SEO Â∑•ÂÖ∑Ê†∑Âºè */
        .seo-container {
            display: none;
            gap: 20px;
        }

        .seo-container.active {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        @media (max-width: 900px) {
            .seo-container.active {
                grid-template-columns: 1fr;
            }
        }

        .seo-tool {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .seo-tool-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .seo-tool-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .seo-tool-subtitle {
            font-size: 0.85rem;
            color: #6c757d;
        }

        .seo-tool-body {
            padding: 20px;
        }

        .seo-input-group {
            margin-bottom: 16px;
        }

        .seo-input-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #495057;
            font-size: 0.9rem;
        }

        .seo-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .seo-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .seo-textarea {
            min-height: 80px;
            resize: vertical;
            font-family: inherit;
        }

        .seo-output-group {
            margin-top: 16px;
        }

        .seo-output-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .seo-output-label span {
            font-weight: 500;
            color: #495057;
            font-size: 0.9rem;
        }

        .seo-output {
            width: 100%;
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            color: #495057;
            word-break: break-all;
        }

        .char-count {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .char-count.warning {
            color: #fd7e14;
        }

        .char-count.danger {
            color: #dc3545;
        }

        /* Google ÊêúÁ¥¢È¢ÑËßàÊ†∑Âºè */
        .serp-preview {
            background: white;
            border: 1px solid #dfe1e5;
            border-radius: 8px;
            padding: 16px;
            font-family: Arial, sans-serif;
            margin-top: 16px;
        }

        .serp-preview-title {
            display: block;
            font-size: 20px;
            line-height: 1.3;
            color: #1a0dab;
            text-decoration: none;
            margin-bottom: 3px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .serp-preview-url {
            font-size: 14px;
            color: #006621;
            margin-bottom: 3px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .serp-preview-description {
            font-size: 14px;
            line-height: 1.58;
            color: #545454;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .serp-label {
            font-size: 0.75rem;
            color: #6c757d;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .slug-options {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .slug-option {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            color: #495057;
        }

        .slug-option input {
            width: 16px;
            height: 16px;
        }

        /* QR Code Generator Styles */
        .qrcode-container {
            display: none;
            gap: 20px;
        }

        .qrcode-container.active {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        @media (max-width: 900px) {
            .qrcode-container.active {
                grid-template-columns: 1fr;
            }
        }

        /* Logo Upload Area */
        .logo-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafbfc;
        }

        .logo-upload-area:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .logo-upload-area.dragover {
            border-color: #667eea;
            background: #e8eeff;
        }

        .logo-placeholder {
            color: #6c757d;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .logo-placeholder svg {
            opacity: 0.5;
        }

        .logo-hint {
            font-size: 0.75rem;
            color: #adb5bd;
        }

        .logo-preview {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
        }

        .logo-preview img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            background: white;
        }

        .btn-sm {
            padding: 4px 10px;
            font-size: 0.8rem;
        }

        /* Batch Section */
        .batch-section {
            margin-top: 20px;
        }

        .batch-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .batch-header label {
            font-weight: 500;
            color: #495057;
            font-size: 0.9rem;
        }

        .batch-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .batch-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #e9ecef;
        }

        .batch-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .batch-item-number {
            font-weight: 600;
            color: #667eea;
            font-size: 0.85rem;
        }

        .btn-remove-item {
            background: none;
            border: none;
            color: #dc3545;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0 4px;
            line-height: 1;
        }

        .btn-remove-item:hover {
            color: #a71d2a;
        }

        .batch-item .seo-input {
            margin-bottom: 8px;
        }

        .batch-item .seo-input:last-child {
            margin-bottom: 0;
        }

        /* QR Code Preview Grid */
        .qr-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 24px;
            min-height: 280px;
            background: #f5f7fa;
            border-radius: 12px;
            padding: 24px;
        }

        .qr-card-wrapper {
            display: flex;
            justify-content: center;
        }

        /* Card Style - Exact Match Reference */
        .qr-card {
            width: 200px;
            background: linear-gradient(135deg,
                #ffffff 0%,
                #f0f4f8 15%,
                #0a1628 40%,
                #0f2847 60%,
                #2563eb 100%);
            border-radius: 20px;
            padding: 8px;
            box-shadow: 0 8px 32px rgba(37, 99, 235, 0.3);
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
        }

        .qr-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(37, 99, 235, 0.4);
        }

        .qr-card-inner {
            background: white;
            border-radius: 12px;
            padding: 8px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #000000;
        }

        .qr-code-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .qr-code-container canvas {
            display: block;
        }

        .qr-placeholder {
            width: 150px;
            height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #adb5bd;
            gap: 8px;
        }

        .qr-placeholder p {
            font-size: 0.75rem;
            margin: 0;
        }

        .qr-logo-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 4px;
            padding: 2px;
            display: none;
        }

        .qr-logo-overlay img {
            width: 36px;
            height: 36px;
            object-fit: contain;
            display: block;
        }

        .qr-logo-overlay.visible {
            display: block;
        }

        .qr-card-footer {
            padding: 14px 8px 8px;
            text-align: center;
        }

        .qr-text {
            color: white;
            font-weight: 500;
            font-size: 0.95rem;
            word-break: break-word;
            line-height: 1.3;
        }

        .qr-download-actions {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
        }

        .qr-download-actions .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-row">
            <div class="header-content">
                <h1>Marketing Tools</h1>
                <p class="subtitle">A collection of useful tools for marketing and content creation</p>
            </div>
            <a href="https://github.com/septemberfd" target="_blank" class="about-author-btn">
                <svg height="20" width="20" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                About Author
            </a>
        </div>

        <div class="mode-tabs">
            <button class="mode-tab active" data-mode="rich">Rich Text</button>
            <button class="mode-tab" data-mode="html">HTML Code</button>
            <button class="mode-tab" data-mode="debug">Debug HTML</button>
            <button class="mode-tab" data-mode="seo">SEO Tools</button>
            <button class="mode-tab" data-mode="qrcode">QR Code Generator</button>
        </div>

        <div class="options">
            <label class="option-item">
                <input type="checkbox" id="opt-gfm" checked>
                GitHub È£éÊ†º (GFM)
            </label>
            <label class="option-item">
                <input type="checkbox" id="opt-code-fence" checked>
                ‰ª£Á†ÅÂùó‰ΩøÁî®Âõ¥Ê†è
            </label>
            <label class="option-item">
                Ê†áÈ¢òÈ£éÊ†º:
                <select id="opt-heading">
                    <option value="atx">ATX (# Ê†áÈ¢ò)</option>
                    <option value="setext">Setext (‰∏ãÂàíÁ∫ø)</option>
                </select>
            </label>
            <label class="option-item">
                ÂàóË°®Á¨¶Âè∑:
                <select id="opt-bullet">
                    <option value="-">- (Áü≠Ê®™Á∫ø)</option>
                    <option value="*">* (ÊòüÂè∑)</option>
                    <option value="+">+ (Âä†Âè∑)</option>
                </select>
            </label>
        </div>

        <div class="main-content">
            <div class="panel input-panel">
                <div class="panel-header">
                    <span class="panel-title" id="input-title">ËæìÂÖ• (Á≤òË¥¥ÂØåÊñáÊú¨)</span>
                    <div class="panel-actions">
                        <button class="btn btn-secondary" id="btn-clear">Ê∏ÖÁ©∫</button>
                    </div>
                </div>
                <div class="panel-body">
                    <div
                        class="rich-input"
                        id="rich-input"
                        contenteditable="true"
                        data-placeholder="‰ªé Google Docs ÊàñÂÖ∂‰ªñÂØåÊñáÊú¨ÁºñËæëÂô®Á≤òË¥¥ÂÜÖÂÆπ..."
                    ></div>
                    <textarea
                        class="html-input hidden"
                        id="html-input"
                        placeholder="Âú®Ê≠§ËæìÂÖ•ÊàñÁ≤òË¥¥ HTML ‰ª£Á†Å..."
                    ></textarea>
                </div>
                <div class="drop-hint" id="drop-hint">ÈáäÊîæ‰ª•Á≤òË¥¥ÂÜÖÂÆπ</div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">Markdown ËæìÂá∫</span>
                    <div class="output-tabs">
                        <button class="output-tab active" data-output="code">Ê∫êÁ†Å</button>
                        <button class="output-tab" data-output="preview">È¢ÑËßà</button>
                    </div>
                    <div class="panel-actions">
                        <button class="btn btn-success" id="btn-copy">Â§çÂà∂ÁªìÊûú</button>
                    </div>
                </div>
                <div class="panel-body">
                    <textarea
                        class="markdown-output"
                        id="markdown-output"
                        placeholder="ËΩ¨Êç¢ÂêéÁöÑ Markdown Â∞ÜÊòæÁ§∫Âú®ËøôÈáå..."
                    ></textarea>
                    <div class="markdown-preview hidden" id="markdown-preview"></div>
                </div>
            </div>
        </div>

        <!-- SEO Â∑•ÂÖ∑Èù¢Êùø -->
        <div class="seo-container" id="seo-container">
            <!-- URL/Slug ÁîüÊàêÂô® -->
            <div class="seo-tool">
                <div class="seo-tool-header">
                    <div class="seo-tool-title">URL Slug ÁîüÊàêÂô®</div>
                    <div class="seo-tool-subtitle">Â∞ÜÊñáÂ≠óËΩ¨Êç¢‰∏∫ URL ÂèãÂ•ΩÁöÑÊ†ºÂºè</div>
                </div>
                <div class="seo-tool-body">
                    <div class="seo-input-group">
                        <label for="slug-input">ËæìÂÖ•ÊñáÂ≠ó</label>
                        <input type="text" class="seo-input" id="slug-input" placeholder="ËæìÂÖ•Ê†áÈ¢òÊàñÊñáÂ≠ó...">
                    </div>
                    <div class="slug-options">
                        <label class="slug-option">
                            <input type="radio" name="slug-style" value="pinyin" checked>
                            ÊãºÈü≥ËΩ¨Êç¢
                        </label>
                        <label class="slug-option">
                            <input type="radio" name="slug-style" value="english">
                            ‰ªÖ‰øùÁïôËã±Êñá
                        </label>
                        <label class="slug-option">
                            <input type="radio" name="slug-style" value="encode">
                            URL ÁºñÁ†Å
                        </label>
                    </div>
                    <div class="seo-output-group">
                        <div class="seo-output-label">
                            <span>ÁîüÊàêÁöÑ URL Slug</span>
                            <button class="btn btn-primary btn-sm" id="btn-copy-slug">Â§çÂà∂</button>
                        </div>
                        <div class="seo-output" id="slug-output">-</div>
                    </div>

                    <!-- URL Prefix Selection -->
                    <div class="seo-input-group" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                        <label>Select URL Prefix</label>
                        <div class="slug-options">
                            <label class="slug-option">
                                <input type="radio" name="url-prefix" value="milvus" checked>
                                milvus.io/blog/
                            </label>
                            <label class="slug-option">
                                <input type="radio" name="url-prefix" value="zilliz">
                                zilliz.com/blog/
                            </label>
                            <label class="slug-option">
                                <input type="radio" name="url-prefix" value="custom">
                                Custom
                            </label>
                        </div>
                        <div class="custom-prefix-input hidden" id="custom-prefix-wrapper" style="margin-top: 10px;">
                            <input type="text" class="seo-input" id="custom-prefix" placeholder="https://example.com/path/">
                        </div>
                    </div>
                    <div class="seo-output-group">
                        <div class="seo-output-label">
                            <span>ÂÆåÊï¥ URL</span>
                            <button class="btn btn-primary btn-sm" id="btn-copy-full-url">Â§çÂà∂</button>
                        </div>
                        <div class="seo-output" id="full-url-output" style="color: #1a0dab;">-</div>
                    </div>
                </div>
            </div>

            <!-- Google ÊêúÁ¥¢È¢ÑËßà -->
            <div class="seo-tool">
                <div class="seo-tool-header">
                    <div class="seo-tool-title">Google ÊêúÁ¥¢È¢ÑËßà</div>
                    <div class="seo-tool-subtitle">È¢ÑËßàÈ°µÈù¢Âú®ÊêúÁ¥¢ÁªìÊûú‰∏≠ÁöÑÊòæÁ§∫ÊïàÊûú</div>
                </div>
                <div class="seo-tool-body">
                    <div class="seo-input-group">
                        <div class="seo-output-label">
                            <label for="serp-title">È°µÈù¢Ê†áÈ¢ò (Title)</label>
                            <span class="char-count" id="title-count">0/60</span>
                        </div>
                        <input type="text" class="seo-input" id="serp-title" placeholder="ËæìÂÖ•È°µÈù¢Ê†áÈ¢ò..." maxlength="100">
                    </div>
                    <div class="seo-input-group">
                        <div class="seo-output-label">
                            <label for="serp-url">È°µÈù¢ URL</label>
                        </div>
                        <input type="text" class="seo-input" id="serp-url" placeholder="https://example.com/your-page">
                    </div>
                    <div class="seo-input-group">
                        <div class="seo-output-label">
                            <label for="serp-description">È°µÈù¢ÊèèËø∞ (Description)</label>
                            <span class="char-count" id="desc-count">0/160</span>
                        </div>
                        <textarea class="seo-input seo-textarea" id="serp-description" placeholder="ËæìÂÖ•È°µÈù¢ÊèèËø∞..." maxlength="300"></textarea>
                    </div>
                    <div class="seo-output-group">
                        <div class="serp-label">ÊêúÁ¥¢ÁªìÊûúÈ¢ÑËßà</div>
                        <div class="serp-preview">
                            <a class="serp-preview-title" id="preview-title">È°µÈù¢Ê†áÈ¢òÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå</a>
                            <div class="serp-preview-url" id="preview-url">https://example.com</div>
                            <div class="serp-preview-description" id="preview-description">È°µÈù¢ÊèèËø∞Â∞ÜÊòæÁ§∫Âú®ËøôÈáå„ÄÇGoogle ÈÄöÂ∏∏‰ºöÊòæÁ§∫Â§ßÁ∫¶ 155-160 ‰∏™Â≠óÁ¨¶ÁöÑÊèèËø∞ÂÜÖÂÆπ„ÄÇ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- QR Code Generator Panel -->
        <div class="qrcode-container" id="qrcode-container">
            <!-- Left: Input Area -->
            <div class="seo-tool">
                <div class="seo-tool-header">
                    <div class="seo-tool-title">QR Code Generator</div>
                    <div class="seo-tool-subtitle">Generate QR codes with custom text and logo</div>
                </div>
                <div class="seo-tool-body">
                    <div class="seo-input-group">
                        <label>Logo (PNG, SVG, JPEG - max 50x50px display)</label>
                        <div class="logo-upload-area" id="logo-upload-area">
                            <input type="file" id="qr-logo" accept=".png,.svg,.jpeg,.jpg,image/png,image/svg+xml,image/jpeg" style="display: none;">
                            <div class="logo-placeholder" id="logo-placeholder">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                    <polyline points="21 15 16 10 5 21"></polyline>
                                </svg>
                                <span>Click or drag to upload logo</span>
                                <small class="logo-hint">Supports PNG, SVG, JPEG</small>
                            </div>
                            <div class="logo-preview hidden" id="logo-preview">
                                <img id="logo-preview-img" alt="Logo preview">
                                <button class="btn btn-secondary btn-sm" id="remove-logo">Remove</button>
                            </div>
                        </div>
                    </div>

                    <div class="batch-section">
                        <div class="batch-header">
                            <label>QR Code Items (up to 10)</label>
                            <button class="btn btn-secondary btn-sm" id="btn-add-item">+ Add Item</button>
                        </div>
                        <div class="batch-items" id="batch-items">
                            <div class="batch-item" data-index="0">
                                <div class="batch-item-header">
                                    <span class="batch-item-number">#1</span>
                                    <button class="btn-remove-item" title="Remove">&times;</button>
                                </div>
                                <input type="url" class="seo-input qr-url-input" placeholder="https://example.com" data-index="0">
                                <input type="text" class="seo-input qr-text-input" placeholder="Text label (e.g., Follow us on X)" data-index="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Preview and Download Area -->
            <div class="seo-tool">
                <div class="seo-tool-header">
                    <div class="seo-tool-title">Preview & Download</div>
                    <div class="seo-tool-subtitle">Real-time preview of generated QR codes</div>
                </div>
                <div class="seo-tool-body">
                    <div class="qr-preview-grid" id="qr-preview-grid">
                        <div class="qr-card-wrapper" data-index="0">
                            <div class="qr-card">
                                <div class="qr-card-inner">
                                    <div class="qr-code-container" id="qr-code-display-0">
                                        <div class="qr-placeholder">
                                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1.5">
                                                <rect x="3" y="3" width="7" height="7"></rect>
                                                <rect x="14" y="3" width="7" height="7"></rect>
                                                <rect x="3" y="14" width="7" height="7"></rect>
                                                <rect x="14" y="14" width="3" height="3"></rect>
                                                <rect x="18" y="14" width="3" height="3"></rect>
                                                <rect x="14" y="18" width="3" height="3"></rect>
                                                <rect x="18" y="18" width="3" height="3"></rect>
                                            </svg>
                                            <p>Enter URL</p>
                                        </div>
                                    </div>
                                    <div class="qr-logo-overlay" id="qr-logo-overlay-0"></div>
                                </div>
                                <div class="qr-card-footer">
                                    <span class="qr-text" id="qr-text-0"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="qr-download-actions">
                        <button class="btn btn-success" id="btn-download-all-png" disabled>Download All PNG</button>
                        <button class="btn btn-primary" id="btn-download-all-zip" disabled>Download as ZIP</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // DOM ÂÖÉÁ¥†
        const richInput = document.getElementById('rich-input');
        const htmlInput = document.getElementById('html-input');
        const markdownOutput = document.getElementById('markdown-output');
        const markdownPreview = document.getElementById('markdown-preview');
        const outputTabs = document.querySelectorAll('.output-tab');
        const modeTabs = document.querySelectorAll('.mode-tab');
        const inputTitle = document.getElementById('input-title');
        const btnClear = document.getElementById('btn-clear');
        const btnCopy = document.getElementById('btn-copy');
        const toast = document.getElementById('toast');
        const dropHint = document.getElementById('drop-hint');

        // ÈÄâÈ°πÂÖÉÁ¥†
        const optGfm = document.getElementById('opt-gfm');
        const optCodeFence = document.getElementById('opt-code-fence');
        const optHeading = document.getElementById('opt-heading');
        const optBullet = document.getElementById('opt-bullet');

        let currentMode = 'rich';
        let currentOutputMode = 'code'; // 'code' Êàñ 'preview'

        // ÂõæÁâáËÆ°Êï∞Âô®ÔºàÂè™Âú®Ê∏ÖÁ©∫Êó∂ÈáçÁΩÆÔºâ
        let imageCounter = 0;

        // MathML ËΩ¨ LaTeX ÂáΩÊï∞
        function mathMLToLaTeX(node) {
            try {
                const mathml = node.outerHTML || new XMLSerializer().serializeToString(node);

                // ÁÆÄÂçïÁöÑ MathML Âà∞ LaTeX ËΩ¨Êç¢Êò†Â∞Ñ
                const conversions = {
                    // Âü∫Êú¨ÁªìÊûÑ
                    '<math[^>]*>': '',
                    '</math>': '',
                    '<mrow>': '{',
                    '</mrow>': '}',
                    '<mi>': '',
                    '</mi>': '',
                    '<mn>': '',
                    '</mn>': '',
                    '<mo>': '',
                    '</mo>': '',

                    // ‰∏ä‰∏ãÊ†á
                    '<msup>': '',
                    '</msup>': '',
                    '<msub>': '_',
                    '</msub>': '',
                    '<msubsup>': '',
                    '</msubsup>': '',

                    // ÂàÜÊï∞
                    '<mfrac>': '\\frac',
                    '</mfrac>': '',

                    // Ê†πÂè∑
                    '<msqrt>': '\\sqrt{',
                    '</msqrt>': '}',
                    '<mroot>': '\\sqrt[',
                    '</mroot>': ']',

                    // Ê±ÇÂíå„ÄÅÁßØÂàÜÁ≠â
                    '<munderover>': '',
                    '</munderover>': '',
                    '<munder>': '',
                    '</munder>': '',
                    '<mover>': '',
                    '</mover>': '',

                    // ÁâπÊÆäÁ¨¶Âè∑
                    '‚àë': '\\sum',
                    '‚àè': '\\prod',
                    '‚à´': '\\int',
                    '‚àÇ': '\\partial',
                    '‚àû': '\\infty',
                    '‚Üí': '\\to',
                    '‚Üê': '\\leftarrow',
                    '‚Üî': '\\leftrightarrow',
                    '‚â§': '\\leq',
                    '‚â•': '\\geq',
                    '‚â†': '\\neq',
                    '‚âà': '\\approx',
                    '¬±': '\\pm',
                    '√ó': '\\times',
                    '√∑': '\\div',
                    '‚ãÖ': '\\cdot',
                    '‚àö': '\\sqrt',
                    '‚àà': '\\in',
                    '‚àâ': '\\notin',
                    '‚äÇ': '\\subset',
                    '‚äÉ': '\\supset',
                    '‚à™': '\\cup',
                    '‚à©': '\\cap',
                    '‚àÄ': '\\forall',
                    '‚àÉ': '\\exists',
                    '‚àÖ': '\\emptyset',
                    'Œ±': '\\alpha',
                    'Œ≤': '\\beta',
                    'Œ≥': '\\gamma',
                    'Œ¥': '\\delta',
                    'Œµ': '\\epsilon',
                    'Œ∏': '\\theta',
                    'Œª': '\\lambda',
                    'Œº': '\\mu',
                    'œÄ': '\\pi',
                    'œÉ': '\\sigma',
                    'œÜ': '\\phi',
                    'œâ': '\\omega',
                    'Œ£': '\\Sigma',
                    'Œ†': '\\Pi',
                    'Œ©': '\\Omega',
                    'ùîº': '\\mathbb{E}',
                    '‚Ñù': '\\mathbb{R}',
                    '‚Ñï': '\\mathbb{N}',
                    '‚Ñ§': '\\mathbb{Z}',
                    '‚ü®': '\\langle',
                    '‚ü©': '\\rangle',
                    '„Äà': '\\langle',
                    '„Äâ': '\\rangle',
                };

                let latex = mathml;

                // Â∫îÁî®ËΩ¨Êç¢
                for (const [pattern, replacement] of Object.entries(conversions)) {
                    latex = latex.replace(new RegExp(pattern, 'g'), replacement);
                }

                // Ê∏ÖÁêÜ HTML Ê†áÁ≠æÂíåÂ±ûÊÄß
                latex = latex.replace(/<[^>]+>/g, '');
                latex = latex.replace(/\s+/g, ' ');
                latex = latex.trim();

                // Â§ÑÁêÜ‰∏äÊ†á
                latex = latex.replace(/\^\s*\{?\s*(\w+)\s*\}?/g, '^{$1}');

                return latex || null;
            } catch (e) {
                console.error('MathML ËΩ¨Êç¢ÈîôËØØ:', e);
                return null;
            }
        }

        // ÂàõÂª∫ Turndown ÂÆû‰æã
        function createTurndownService() {
            // Ê≥®ÊÑèÔºö‰∏çÂÜçÂú®ËøôÈáåÈáçÁΩÆ imageCounterÔºåÂõ†‰∏∫Á≤òË¥¥ÂõæÁâáÊó∂Â∑≤ÁªèËÆæÁΩÆ‰∫ÜÁ¥¢Âºï

            const options = {
                headingStyle: optHeading.value,
                bulletListMarker: optBullet.value,
                codeBlockStyle: optCodeFence.checked ? 'fenced' : 'indented',
                emDelimiter: '*',
                strongDelimiter: '**',
                linkStyle: 'inlined',
            };

            const turndownService = new TurndownService(options);

            // ‰ΩøÁî® GFM Êèí‰ª∂ÔºàÁî®‰∫é‰ªªÂä°ÂàóË°®„ÄÅÂà†Èô§Á∫øÁ≠âÔºå‰ΩÜ‰∏çÁî®ÂÖ∂Ë°®Ê†ºÂ§ÑÁêÜÔºâ
            if (optGfm.checked && window.turndownPluginGfm) {
                // Âè™‰ΩøÁî® strikethrough Âíå taskListItems
                turndownService.use(turndownPluginGfm.strikethrough);
                turndownService.use(turndownPluginGfm.taskListItems);
            }

            // Ëá™ÂÆö‰πâË°®Ê†ºÂ§ÑÁêÜËßÑÂàô - Â§ÑÁêÜ Google Docs Ë°®Ê†º
            turndownService.addRule('googleDocsTable', {
                filter: function(node) {
                    return node.nodeName === 'TABLE';
                },
                replacement: function(content, node) {
                    const rows = node.querySelectorAll('tr');
                    if (rows.length === 0) return '';

                    let markdown = '\n\n';
                    let columnCount = 0;

                    rows.forEach((row, rowIndex) => {
                        const cells = row.querySelectorAll('td, th');
                        if (cells.length === 0) return;

                        // Ëé∑ÂèñÂàóÊï∞ÔºàÁ¨¨‰∏ÄË°åÂÜ≥ÂÆöÔºâ
                        if (rowIndex === 0) {
                            columnCount = cells.length;
                        }

                        // ÊûÑÂª∫Ë°å
                        let rowContent = '|';
                        cells.forEach(cell => {
                            // Ëé∑ÂèñÂçïÂÖÉÊ†ºÊñáÊú¨ÔºåÊ∏ÖÁêÜÊç¢Ë°åÂíåÂ§ö‰ΩôÁ©∫Ê†º
                            let cellText = cell.textContent.trim()
                                .replace(/\n/g, ' ')
                                .replace(/\s+/g, ' ')
                                .replace(/\|/g, '\\|'); // ËΩ¨‰πâÁÆ°ÈÅìÁ¨¶
                            rowContent += ' ' + cellText + ' |';
                        });
                        markdown += rowContent + '\n';

                        // Á¨¨‰∏ÄË°åÂêéÊ∑ªÂä†ÂàÜÈöîÁ¨¶
                        if (rowIndex === 0) {
                            let separator = '|';
                            for (let i = 0; i < columnCount; i++) {
                                separator += ' --- |';
                            }
                            markdown += separator + '\n';
                        }
                    });

                    return markdown + '\n';
                }
            });

            // Â§ÑÁêÜÊàë‰ª¨Ëá™Â∑±ÊèíÂÖ•ÁöÑÂõæÁâáÂç†‰ΩçÁ¨¶Ê†áËÆ∞
            turndownService.addRule('imagePlaceholderMarker', {
                filter: function(node) {
                    return node.hasAttribute && node.hasAttribute('data-image-placeholder');
                },
                replacement: function(content, node) {
                    const index = node.getAttribute('data-image-placeholder');
                    const name = node.getAttribute('data-image-name') || 'ÂõæÁâá' + index;
                    return '\n\n![' + name + '](IMAGE_PLACEHOLDER_' + index + ')\n\n';
                }
            });

            // Â§ÑÁêÜÂõæÁâá - ËΩ¨Êç¢‰∏∫ placeholderÔºàÂ¢ûÂº∫ÁâàÔºåÊîØÊåÅÂ§öÁßçÂõæÁâáÊ†ºÂºèÔºâ
            turndownService.addRule('images', {
                filter: function(node) {
                    // Ê†áÂáÜ img Ê†áÁ≠æ
                    if (node.nodeName === 'IMG') return true;
                    // picture ÂÖÉÁ¥†‰∏≠ÁöÑ source
                    if (node.nodeName === 'PICTURE') return true;
                    return false;
                },
                replacement: function(content, node) {
                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÊúâÁ¥¢Âºï
                    let index = node.getAttribute('data-image-index');
                    if (!index) {
                        imageCounter++;
                        index = imageCounter;
                    }

                    let alt = 'ÂõæÁâá' + index;

                    if (node.nodeName === 'IMG') {
                        alt = node.getAttribute('alt') || alt;
                    } else if (node.nodeName === 'PICTURE') {
                        const img = node.querySelector('img');
                        if (img) alt = img.getAttribute('alt') || alt;
                    }

                    return '\n\n![' + alt + '](IMAGE_PLACEHOLDER_' + index + ')\n\n';
                }
            });

            // Â§ÑÁêÜ Google Docs ÁâπÊÆäÁöÑÂõæÁâáÂÆπÂô®
            // Google Docs Á≤òË¥¥ÁöÑÂõæÁâáÈÄöÂ∏∏Ë¢´ÂåÖË£πÂú®ÁâπÊÆäÁªìÊûÑ‰∏≠
            turndownService.addRule('googleDocsImageContainer', {
                filter: function(node) {
                    // Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´ Google Docs ÂõæÁâáÁöÑÂêÑÁßçÁâπÂæÅ
                    if (node.nodeName === 'SPAN' || node.nodeName === 'DIV' || node.nodeName === 'P') {
                        // Ê£ÄÊü•ÂÜÖÈÉ®ÊòØÂê¶ÊúâÂõæÁâá
                        const hasImg = node.querySelector('img');
                        if (hasImg) {
                            // Â¶ÇÊûúÁõ¥Êé•Â≠êÂÖÉÁ¥†Âè™Êúâ‰∏Ä‰∏™ imgÔºåËÆ© img ËßÑÂàôÂ§ÑÁêÜ
                            if (node.children.length === 1 && node.children[0].nodeName === 'IMG') {
                                return false;
                            }
                            return true;
                        }

                        // Ê£ÄÊü• style ‰∏≠ÊòØÂê¶Êúâ background-image
                        const style = node.getAttribute('style') || '';
                        if (style.includes('background-image') || style.includes('background:')) {
                            return true;
                        }

                        // Google Docs ÊúâÊó∂Áî® data-* Â±ûÊÄßÊ†áËÆ∞ÂõæÁâá
                        const attrs = node.attributes;
                        for (let i = 0; i < attrs.length; i++) {
                            const attrName = attrs[i].name.toLowerCase();
                            if (attrName.startsWith('data-') &&
                                (attrName.includes('image') || attrName.includes('src'))) {
                                return true;
                            }
                        }
                    }
                    return false;
                },
                replacement: function(content, node) {
                    // ÂÖàÊ£ÄÊü•ÂÜÖÈÉ®ÊúâÊ≤°ÊúâÂ∑≤ÁªèÂ§ÑÁêÜËøáÁöÑÂõæÁâáÊ†áËÆ∞
                    if (content.includes('IMAGE_PLACEHOLDER_') || content.includes('CHART_PLACEHOLDER_')) {
                        return content;
                    }

                    imageCounter++;
                    const innerImg = node.querySelector('img');
                    const alt = innerImg ? (innerImg.getAttribute('alt') || 'ÂõæÁâá' + imageCounter) : 'ÂõæÁâá' + imageCounter;
                    return '\n\n![' + alt + '](IMAGE_PLACEHOLDER_' + imageCounter + ')\n\n';
                }
            });

            // Â§ÑÁêÜ SVG ÂõæÂΩ¢
            turndownService.addRule('svgImages', {
                filter: 'svg',
                replacement: function(content, node) {
                    imageCounter++;
                    return '\n\n![SVGÂõæÂΩ¢' + imageCounter + '](SVG_PLACEHOLDER_' + imageCounter + ')\n\n';
                }
            });

            // Â§ÑÁêÜ canvas ÂÖÉÁ¥†
            turndownService.addRule('canvasImages', {
                filter: 'canvas',
                replacement: function(content, node) {
                    imageCounter++;
                    return '\n\n![CanvasÂõæÂΩ¢' + imageCounter + '](CANVAS_PLACEHOLDER_' + imageCounter + ')\n\n';
                }
            });

            // Â§ÑÁêÜ figure ÂÖÉÁ¥†ÔºàÂ∏∏ËßÅÁöÑÂõæÁâáÂÆπÂô®Ôºâ
            turndownService.addRule('figureImages', {
                filter: 'figure',
                replacement: function(content, node) {
                    // Â¶ÇÊûúÂ∑≤ÁªèÊúâ placeholderÔºåÁõ¥Êé•ËøîÂõû
                    if (content.includes('PLACEHOLDER_')) {
                        // ÊèêÂèñ figcaption ‰Ωú‰∏∫ËØ¥Êòé
                        const figcaption = node.querySelector('figcaption');
                        if (figcaption) {
                            return content + '\n*' + figcaption.textContent.trim() + '*\n';
                        }
                        return content;
                    }

                    imageCounter++;
                    const figcaption = node.querySelector('figcaption');
                    const caption = figcaption ? figcaption.textContent.trim() : '';
                    const alt = caption || 'ÂõæÁâá' + imageCounter;

                    let result = '\n\n![' + alt + '](IMAGE_PLACEHOLDER_' + imageCounter + ')';
                    if (caption) {
                        result += '\n*' + caption + '*';
                    }
                    return result + '\n\n';
                }
            });

            // Â§ÑÁêÜ object/embed ÂÖÉÁ¥†ÔºàÂµåÂÖ•ÂÜÖÂÆπÔºâ
            turndownService.addRule('embeddedContent', {
                filter: ['object', 'embed', 'iframe'],
                replacement: function(content, node) {
                    imageCounter++;
                    const type = node.nodeName.toLowerCase();
                    return '\n\n![ÂµåÂÖ•ÂÜÖÂÆπ' + imageCounter + '](EMBED_PLACEHOLDER_' + imageCounter + ')\n\n';
                }
            });

            // Â§ÑÁêÜ MathML Êï∞Â≠¶ÂÖ¨Âºè - ËΩ¨Êç¢‰∏∫ LaTeX
            turndownService.addRule('mathML', {
                filter: function(node) {
                    return node.nodeName === 'MATH' ||
                           node.nodeName === 'math' ||
                           (node.namespaceURI && node.namespaceURI.includes('MathML'));
                },
                replacement: function(content, node) {
                    const latex = mathMLToLaTeX(node);
                    if (latex) {
                        // Ê£ÄÊü•ÊòØÂê¶ÊòØÂùóÁ∫ßÂÖ¨Âºè
                        const display = node.getAttribute('display');
                        if (display === 'block' || node.parentNode.nodeName === 'P') {
                            return '\n\n$$\n' + latex + '\n$$\n\n';
                        }
                        return ' $' + latex + '$ ';
                    }
                    return '\n\n$$MATH_FORMULA_PLACEHOLDER$$\n\n';
                }
            });

            // Â§ÑÁêÜ Google Docs ÁöÑÂÖ¨ÂºèÔºàÈÄöÂ∏∏ÊòØÂõæÁâáÂΩ¢ÂºèÔºâ
            turndownService.addRule('googleDocsFormula', {
                filter: function(node) {
                    if (node.nodeName === 'IMG') {
                        const src = node.getAttribute('src') || '';
                        const alt = node.getAttribute('alt') || '';
                        // Google Docs ÂÖ¨ÂºèÂõæÁâáÈÄöÂ∏∏ÊúâÁâπÂÆöÁâπÂæÅ
                        if (src.includes('chart') || src.includes('equation') ||
                            alt.includes('equation') || alt.includes('formula')) {
                            return true;
                        }
                    }
                    // Ê£ÄÊü•ÊòØÂê¶ÊòØÂÖ¨ÂºèÂÆπÂô®
                    if (node.nodeName === 'SPAN' || node.nodeName === 'DIV') {
                        const className = node.className || '';
                        if (className.includes('equation') || className.includes('math') ||
                            className.includes('formula') || className.includes('katex')) {
                            return true;
                        }
                    }
                    return false;
                },
                replacement: function(content, node) {
                    // Â∞ùËØï‰ªé data Â±ûÊÄßËé∑Âèñ LaTeX
                    const latex = node.getAttribute('data-latex') ||
                                  node.getAttribute('data-formula') ||
                                  node.getAttribute('alt');
                    if (latex && latex.includes('\\')) {
                        return '\n\n$$\n' + latex + '\n$$\n\n';
                    }
                    return '\n\n$$MATH_FORMULA_PLACEHOLDER$$\n\n';
                }
            });

            // Â§ÑÁêÜ CSS Ê†∑ÂºèÂä†Á≤óÔºàfont-weight: bold Êàñ font-weight: 700 Á≠âÔºâ
            turndownService.addRule('cssBold', {
                filter: function(node) {
                    if (node.nodeName === 'SPAN' || node.nodeName === 'P' || node.nodeName === 'DIV') {
                        const style = node.getAttribute('style') || '';
                        const computedStyle = node.style;
                        const fontWeight = computedStyle.fontWeight || '';

                        // Ê£ÄÊü• font-weight ÊòØÂê¶‰∏∫Âä†Á≤ó
                        if (fontWeight === 'bold' || fontWeight === 'bolder' ||
                            (parseInt(fontWeight) >= 600)) {
                            return true;
                        }

                        // ‰πüÊ£ÄÊü•ÂÜÖËÅîÊ†∑ÂºèÂ≠óÁ¨¶‰∏≤
                        if (style.match(/font-weight:\s*(bold|bolder|[6-9]00)/i)) {
                            return true;
                        }
                    }
                    return false;
                },
                replacement: function(content, node) {
                    // ÈÅøÂÖçÁ©∫ÂÜÖÂÆπ
                    if (!content.trim()) return '';
                    // ÈÅøÂÖçÈáçÂ§çÂä†Á≤ó
                    if (content.startsWith('**') && content.endsWith('**')) {
                        return content;
                    }
                    return '**' + content.trim() + '**';
                }
            });

            // Â§ÑÁêÜ CSS Ê†∑ÂºèÊñú‰ΩìÔºàfont-style: italicÔºâ
            turndownService.addRule('cssItalic', {
                filter: function(node) {
                    if (node.nodeName === 'SPAN' || node.nodeName === 'P' || node.nodeName === 'DIV') {
                        const style = node.getAttribute('style') || '';
                        const computedStyle = node.style;
                        const fontStyle = computedStyle.fontStyle || '';

                        if (fontStyle === 'italic' || fontStyle === 'oblique') {
                            return true;
                        }

                        if (style.match(/font-style:\s*(italic|oblique)/i)) {
                            return true;
                        }
                    }
                    return false;
                },
                replacement: function(content, node) {
                    if (!content.trim()) return '';
                    if (content.startsWith('*') && content.endsWith('*') &&
                        !content.startsWith('**')) {
                        return content;
                    }
                    return '*' + content.trim() + '*';
                }
            });

            // Ëá™ÂÆö‰πâËßÑÂàôÔºöÂ§ÑÁêÜ Google Docs ÁöÑ‰ª£Á†ÅÊ†∑Âºè
            turndownService.addRule('googleDocsCode', {
                filter: function(node) {
                    if (node.nodeName === 'SPAN') {
                        const style = node.getAttribute('style') || '';
                        const fontFamily = style.match(/font-family:\s*["']?([^;"']+)/i);
                        if (fontFamily) {
                            const font = fontFamily[1].toLowerCase();
                            return font.includes('mono') ||
                                   font.includes('courier') ||
                                   font.includes('consolas') ||
                                   font.includes('source code');
                        }
                    }
                    return false;
                },
                replacement: function(content, node) {
                    // Áõ¥Êé•‰ΩøÁî®ÂéüÂßãÊñáÊú¨ÔºåÈÅøÂÖçËΩ¨‰πâÈóÆÈ¢ò
                    const text = node.textContent || content;
                    return '`' + text + '`';
                }
            });

            // Â§ÑÁêÜ pre Âíå code Ê†áÁ≠æ
            turndownService.addRule('codeBlocks', {
                filter: ['pre'],
                replacement: function(content, node) {
                    const language = node.getAttribute('data-language') ||
                                   node.className.match(/language-(\w+)/)?.[1] || '';
                    // Áõ¥Êé•‰ΩøÁî® textContent ÈÅøÂÖçËΩ¨‰πâÈóÆÈ¢ò
                    const code = node.textContent || '';
                    if (optCodeFence.checked) {
                        return '\n\n```' + language + '\n' + code.trim() + '\n```\n\n';
                    } else {
                        return '\n\n    ' + code.trim().replace(/\n/g, '\n    ') + '\n\n';
                    }
                }
            });

            // Â§ÑÁêÜ code Ê†áÁ≠æÔºàÂÜÖËÅî‰ª£Á†ÅÔºâ
            turndownService.addRule('inlineCode', {
                filter: function(node) {
                    return node.nodeName === 'CODE' &&
                           node.parentNode &&
                           node.parentNode.nodeName !== 'PRE';
                },
                replacement: function(content, node) {
                    // Áõ¥Êé•‰ΩøÁî® textContent
                    return '`' + node.textContent + '`';
                }
            });

            // Â§ÑÁêÜÈ´ò‰∫Æ/ËÉåÊôØËâ≤ÊñáÊú¨ÔºàÂèØËÉΩÊòØ‰ª£Á†ÅÔºâ
            turndownService.addRule('highlightedCode', {
                filter: function(node) {
                    if (node.nodeName === 'SPAN' || node.nodeName === 'MARK') {
                        const style = node.getAttribute('style') || '';
                        return style.includes('background-color') &&
                               (style.includes('#f') || style.includes('rgb(24'));
                    }
                    return false;
                },
                replacement: function(content, node) {
                    const text = node.textContent || content;
                    if (text.includes('\n')) {
                        return '\n```\n' + text + '\n```\n';
                    }
                    return '`' + text + '`';
                }
            });

            // ÁßªÈô§Á©∫ÁöÑ span Ê†áÁ≠æ
            turndownService.addRule('emptySpan', {
                filter: function(node) {
                    return node.nodeName === 'SPAN' && !node.textContent.trim();
                },
                replacement: function() {
                    return '';
                }
            });

            // Á¶ÅÁî®ÈªòËÆ§ÁöÑËΩ¨‰πâËßÑÂàô‰∏≠ÂØπÂèçÂºïÂè∑ÁöÑÂ§ÑÁêÜ
            turndownService.escape = function(string) {
                return string
                    .replace(/\[/g, '\\[')
                    .replace(/\]/g, '\\]');
                    // ‰∏çÂÜçËΩ¨‰πâÂèçÂºïÂè∑ÂíåÂÖ∂‰ªñÂ≠óÁ¨¶
            };

            return turndownService;
        }

        // È¢ÑÂ§ÑÁêÜ HTMLÔºåÊ†áËÆ∞ÊâÄÊúâÂõæÁâáÁõ∏ÂÖ≥ÂÖÉÁ¥†
        function preprocessHtml(html) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            let imgIndex = 0;

            // Êü•ÊâæÊâÄÊúâÂèØËÉΩÁöÑÂõæÁâáÂÖÉÁ¥†Âπ∂Ê∑ªÂä†Ê†áËÆ∞
            const selectors = [
                'img',
                'svg',
                'canvas',
                'picture',
                'figure',
                '[style*="background-image"]',
                '[style*="background:"]'
            ];

            selectors.forEach(selector => {
                try {
                    doc.querySelectorAll(selector).forEach(el => {
                        if (!el.hasAttribute('data-md-image-marked')) {
                            el.setAttribute('data-md-image-marked', 'true');
                            el.setAttribute('data-md-image-index', ++imgIndex);
                        }
                    });
                } catch (e) {
                    // ÂøΩÁï•Êó†ÊïàÈÄâÊã©Âô®ÈîôËØØ
                }
            });

            return doc.body.innerHTML;
        }

        // ËΩ¨Êç¢ÂáΩÊï∞
        function convert() {
            let html = '';

            if (currentMode === 'rich' || currentMode === 'debug') {
                html = richInput.innerHTML;
            } else {
                html = htmlInput.value;
            }

            if (!html.trim()) {
                markdownOutput.value = '';
                return;
            }

            // Debug Ê®°ÂºèÔºöÊòæÁ§∫ÂéüÂßã HTML
            if (currentMode === 'debug') {
                // Ê†ºÂºèÂåñ HTML ‰ª•‰æøÊü•Áúã
                const formatted = html
                    .replace(/></g, '>\n<')
                    .replace(/(<[^>]+>)/g, function(match) {
                        return match;
                    });
                markdownOutput.value = '=== ÂéüÂßã HTML ===\n\n' + formatted + '\n\n=== Ê£ÄÊµãÂà∞ÁöÑÂõæÁâáÂÖÉÁ¥† ===\n' + detectImages(html);
                return;
            }

            try {
                // È¢ÑÂ§ÑÁêÜ HTML
                const processedHtml = preprocessHtml(html);

                const turndownService = createTurndownService();
                let markdown = turndownService.turndown(processedHtml);

                // Ê∏ÖÁêÜÂ§ö‰ΩôÁöÑÂèçÊñúÊù†ËΩ¨‰πâÔºàÁâπÂà´ÊòØ‰ª£Á†ÅÂùó‰∏≠ÁöÑÔºâ
                markdown = markdown
                    // ‰øÆÂ§ç‰ª£Á†ÅÂùó‰∏≠ÁöÑËΩ¨‰πâÂèçÂºïÂè∑ \` -> `
                    .replace(/\\`/g, '`')
                    // ‰øÆÂ§çËΩ¨‰πâÁöÑÂèçÊñúÊù†
                    .replace(/\\\\/g, '\\')
                    // ‰øÆÂ§çËΩ¨‰πâÁöÑÊòüÂè∑ÔºàÂú®‰ª£Á†ÅÂùóÂÜÖ‰∏çÈúÄË¶ÅËΩ¨‰πâÔºâ
                    .replace(/\\\*/g, '*')
                    // ‰øÆÂ§çËΩ¨‰πâÁöÑ‰∏ãÂàíÁ∫ø
                    .replace(/\\_/g, '_')
                    // Ê∏ÖÁêÜÂ§ö‰ΩôÁöÑÁ©∫Ë°å
                    .replace(/\n{3,}/g, '\n\n')
                    .trim();

                markdownOutput.value = markdown;
                updatePreview();
            } catch (error) {
                console.error('ËΩ¨Êç¢ÈîôËØØ:', error);
                markdownOutput.value = 'ËΩ¨Êç¢Âá∫Èîô: ' + error.message;
                updatePreview();
            }
        }

        // Êõ¥Êñ∞ Markdown È¢ÑËßà
        function updatePreview() {
            const markdown = markdownOutput.value;
            if (!markdown.trim()) {
                markdownPreview.innerHTML = '<p style="color: #999;">È¢ÑËßàÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå...</p>';
                return;
            }

            try {
                // ÂÖàÁî® marked Ëß£Êûê markdown
                let html = marked.parse(markdown);

                // ÁÑ∂ÂêéÂ∞ÜÂç†‰ΩçÁ¨¶ÂõæÁâáÊõøÊç¢‰∏∫ÂèãÂ•ΩÁöÑÊòæÁ§∫Ê†ºÂºè
                html = html
                    .replace(/<img[^>]*src="IMAGE_PLACEHOLDER_(\d+)"[^>]*alt="([^"]*)"[^>]*>/gi,
                        '<div style="background:#e3f2fd;padding:12px 16px;margin:16px 0;border-radius:6px;border:1px dashed #2196f3;color:#1565c0;text-align:center;">üì∑ $2 (ÈúÄË¶Å‰∏ä‰º†ÂõæÁâá)</div>')
                    .replace(/<img[^>]*alt="([^"]*)"[^>]*src="IMAGE_PLACEHOLDER_(\d+)"[^>]*>/gi,
                        '<div style="background:#e3f2fd;padding:12px 16px;margin:16px 0;border-radius:6px;border:1px dashed #2196f3;color:#1565c0;text-align:center;">üì∑ $1 (ÈúÄË¶Å‰∏ä‰º†ÂõæÁâá)</div>')
                    .replace(/<img[^>]*src="SVG_PLACEHOLDER_(\d+)"[^>]*>/gi,
                        '<div style="background:#fff3e0;padding:12px 16px;margin:16px 0;border-radius:6px;border:1px dashed #ff9800;color:#e65100;text-align:center;">üé® SVGÂõæÂΩ¢$1 (SVG ÂõæÂΩ¢)</div>')
                    .replace(/<img[^>]*src="CANVAS_PLACEHOLDER_(\d+)"[^>]*>/gi,
                        '<div style="background:#f3e5f5;padding:12px 16px;margin:16px 0;border-radius:6px;border:1px dashed #9c27b0;color:#7b1fa2;text-align:center;">üñºÔ∏è CanvasÂõæÂΩ¢$1 (Canvas ÂõæÂΩ¢)</div>')
                    .replace(/<img[^>]*src="EMBED_PLACEHOLDER_(\d+)"[^>]*>/gi,
                        '<div style="background:#e8f5e9;padding:12px 16px;margin:16px 0;border-radius:6px;border:1px dashed #4caf50;color:#2e7d32;text-align:center;">üì¶ ÂµåÂÖ•ÂÜÖÂÆπ$1 (ÂµåÂÖ•ÂÜÖÂÆπ)</div>')
                    .replace(/<img[^>]*src="CHART_PLACEHOLDER_(\d+)"[^>]*>/gi,
                        '<div style="background:#fff8e1;padding:12px 16px;margin:16px 0;border-radius:6px;border:1px dashed #ffc107;color:#f57c00;text-align:center;">üìä ÂõæË°®$1 (ÂõæË°®)</div>');

                // Â§ÑÁêÜÂÖ¨ÂºèÂç†‰ΩçÁ¨¶
                html = html.replace(/MATH_FORMULA_PLACEHOLDER/g,
                    '<div style="background:#fce4ec;padding:12px 16px;margin:16px 0;border-radius:6px;border:1px dashed #e91e63;color:#c2185b;text-align:center;">üìê Êï∞Â≠¶ÂÖ¨Âºè (ÈúÄË¶ÅÊâãÂä®ËæìÂÖ• LaTeX)</div>');

                markdownPreview.innerHTML = html;

                // ‰ΩøÁî® KaTeX Ê∏≤ÊüìÊï∞Â≠¶ÂÖ¨Âºè
                if (typeof renderMathInElement !== 'undefined') {
                    renderMathInElement(markdownPreview, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false},
                            {left: '\\[', right: '\\]', display: true},
                            {left: '\\(', right: '\\)', display: false}
                        ],
                        throwOnError: false,
                        errorColor: '#e53935'
                    });
                }
            } catch (error) {
                console.error('È¢ÑËßàÈîôËØØ:', error);
                markdownPreview.innerHTML = '<p style="color: #e53935;">È¢ÑËßàÂá∫Èîô: ' + error.message + '</p>';
            }
        }

        // Ê£ÄÊµã HTML ‰∏≠ÁöÑÂõæÁâáÂÖÉÁ¥†ÔºàÁî®‰∫éË∞ÉËØïÔºâ
        function detectImages(html) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            let result = [];

            // Ê£ÄÊµãÂêÑÁ±ªÂõæÁâáÂÖÉÁ¥†
            const imgs = doc.querySelectorAll('img');
            if (imgs.length > 0) {
                result.push(`ÂèëÁé∞ ${imgs.length} ‰∏™ <img> Ê†áÁ≠æ`);
                imgs.forEach((img, i) => {
                    const src = img.getAttribute('src') || '';
                    const srcPreview = src.length > 100 ? src.substring(0, 100) + '...' : src;
                    result.push(`  [${i+1}] src: ${srcPreview}`);
                });
            }

            const svgs = doc.querySelectorAll('svg');
            if (svgs.length > 0) {
                result.push(`ÂèëÁé∞ ${svgs.length} ‰∏™ <svg> ÂÖÉÁ¥†`);
            }

            const bgImages = doc.querySelectorAll('[style*="background-image"], [style*="background:"]');
            if (bgImages.length > 0) {
                result.push(`ÂèëÁé∞ ${bgImages.length} ‰∏™Â∏¶ËÉåÊôØÂõæÁöÑÂÖÉÁ¥†`);
            }

            const figures = doc.querySelectorAll('figure');
            if (figures.length > 0) {
                result.push(`ÂèëÁé∞ ${figures.length} ‰∏™ <figure> ÂÖÉÁ¥†`);
            }

            if (result.length === 0) {
                result.push('Êú™Ê£ÄÊµãÂà∞‰ªª‰ΩïÂõæÁâáÂÖÉÁ¥†');
                result.push('');
                result.push('ÊèêÁ§∫ÔºöGoogle Docs ÁöÑÂõæÁâáÂèØËÉΩÊ≤°ÊúâË¢´Â§çÂà∂„ÄÇ');
                result.push('Âª∫ËÆÆÔºöÂÖàÂ∞ÜÂõæÁâá‰∏ä‰º†Âà∞ÂõæÂ∫äÔºåÂÜçÊâãÂä®Ê∑ªÂä†ÂõæÁâáÈìæÊé•„ÄÇ');
            }

            return result.join('\n');
        }

        // ÊòæÁ§∫ Toast
        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // ÂàáÊç¢Ê®°Âºè
        modeTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                modeTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentMode = tab.dataset.mode;

                if (currentMode === 'rich') {
                    richInput.classList.remove('hidden');
                    htmlInput.classList.add('hidden');
                    inputTitle.textContent = 'ËæìÂÖ• (Á≤òË¥¥ÂØåÊñáÊú¨)';
                } else if (currentMode === 'html') {
                    richInput.classList.add('hidden');
                    htmlInput.classList.remove('hidden');
                    inputTitle.textContent = 'ËæìÂÖ• (HTML ‰ª£Á†Å)';
                } else if (currentMode === 'debug') {
                    richInput.classList.remove('hidden');
                    htmlInput.classList.add('hidden');
                    inputTitle.textContent = 'ËæìÂÖ• (Ë∞ÉËØïÊ®°Âºè - Êü•ÁúãÂéüÂßã HTML)';
                }

                convert();
            });
        });

        // ËæìÂá∫Ê®°ÂºèÂàáÊç¢ÔºàÊ∫êÁ†Å/È¢ÑËßàÔºâ
        outputTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                outputTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentOutputMode = tab.dataset.output;

                if (currentOutputMode === 'code') {
                    markdownOutput.classList.remove('hidden');
                    markdownPreview.classList.add('hidden');
                } else {
                    markdownOutput.classList.add('hidden');
                    markdownPreview.classList.remove('hidden');
                    updatePreview();
                }
            });
        });

        // ÂØåÊñáÊú¨ËæìÂÖ•‰∫ã‰ª∂
        richInput.addEventListener('input', () => {
            convert();
        });

        richInput.addEventListener('paste', (e) => {
            const clipboardData = e.clipboardData || window.clipboardData;
            const items = clipboardData.items;

            // Ê£ÄÊü•ÊòØÂê¶ÊúâÁ∫ØÂõæÁâáÊñá‰ª∂ÔºàÊà™ÂõæÁ≤òË¥¥Ôºâ
            let imageFile = null;
            const htmlContent = clipboardData.getData('text/html');

            if (items) {
                for (let i = 0; i < items.length; i++) {
                    if (items[i].type.indexOf('image') !== -1 && items[i].kind === 'file') {
                        imageFile = items[i].getAsFile();
                        break;
                    }
                }
            }

            // Â¶ÇÊûúÊòØÁ∫ØÊà™ÂõæÁ≤òË¥¥ÔºàÊúâÂõæÁâáÊñá‰ª∂‰ΩÜÊ≤°Êúâ HTMLÔºâÔºåÊèíÂÖ•ÁúüÂÆûÂõæÁâá
            if (imageFile && !htmlContent) {
                e.preventDefault();

                const reader = new FileReader();
                reader.onload = function(event) {
                    imageCounter++;
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.alt = 'ÂõæÁâá' + imageCounter;
                    img.setAttribute('data-image-index', imageCounter);
                    img.style.maxWidth = '100%';
                    img.style.height = 'auto';
                    img.style.display = 'block';
                    img.style.margin = '8px 0';

                    const selection = window.getSelection();
                    if (selection.rangeCount > 0) {
                        const range = selection.getRangeAt(0);
                        range.deleteContents();
                        range.insertNode(img);
                        range.setStartAfter(img);
                        range.collapse(true);
                        selection.removeAllRanges();
                        selection.addRange(range);
                    } else {
                        richInput.appendChild(img);
                    }

                    setTimeout(convert, 0);
                };
                reader.readAsDataURL(imageFile);
            } else {
                // Êúâ HTML ÂÜÖÂÆπÊàñÁ∫ØÊñáÊú¨ÔºåËÆ©ÈªòËÆ§Á≤òË¥¥Ë°å‰∏∫ÂèëÁîü
                // Á≤òË¥¥ÂêéÂ§ÑÁêÜÂõæÁâáÊ†áËÆ∞
                setTimeout(() => {
                    const imgs = richInput.querySelectorAll('img:not([data-image-index])');
                    imgs.forEach(img => {
                        imageCounter++;
                        img.setAttribute('data-image-index', imageCounter);
                        img.style.maxWidth = '100%';
                        img.style.height = 'auto';
                    });
                    convert();
                }, 100);
            }
        });

        // HTML ËæìÂÖ•‰∫ã‰ª∂
        htmlInput.addEventListener('input', convert);

        // Ê∏ÖÁ©∫ÊåâÈíÆ
        btnClear.addEventListener('click', () => {
            if (currentMode === 'rich' || currentMode === 'debug') {
                richInput.innerHTML = '';
            } else {
                htmlInput.value = '';
            }
            markdownOutput.value = '';
            imageCounter = 0; // ÈáçÁΩÆÂõæÁâáËÆ°Êï∞Âô®
        });

        // Â§çÂà∂ÊåâÈíÆ
        btnCopy.addEventListener('click', async () => {
            const text = markdownOutput.value;
            if (!text) {
                showToast('Ê≤°ÊúâÂèØÂ§çÂà∂ÁöÑÂÜÖÂÆπ');
                return;
            }

            try {
                await navigator.clipboard.writeText(text);
                showToast('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø!');
            } catch (err) {
                // ÈôçÁ∫ßÊñπÊ°à
                markdownOutput.select();
                document.execCommand('copy');
                showToast('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø!');
            }
        });

        // ÈÄâÈ°πÂèòÂåñÊó∂ÈáçÊñ∞ËΩ¨Êç¢
        [optGfm, optCodeFence, optHeading, optBullet].forEach(opt => {
            opt.addEventListener('change', convert);
        });

        // ÊãñÊãΩÊîØÊåÅ
        const inputPanel = document.querySelector('.input-panel');

        inputPanel.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropHint.classList.add('show');
        });

        inputPanel.addEventListener('dragleave', () => {
            dropHint.classList.remove('show');
        });

        inputPanel.addEventListener('drop', async (e) => {
            e.preventDefault();
            dropHint.classList.remove('show');

            const html = e.dataTransfer.getData('text/html');
            const text = e.dataTransfer.getData('text/plain');

            if (html) {
                if (currentMode === 'rich') {
                    richInput.innerHTML = html;
                } else {
                    htmlInput.value = html;
                }
            } else if (text) {
                if (currentMode === 'rich') {
                    richInput.textContent = text;
                } else {
                    htmlInput.value = text;
                }
            }

            convert();
        });

        // ÈîÆÁõòÂø´Êç∑ÈîÆ
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + Shift + C: Â§çÂà∂ÁªìÊûú
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'C') {
                e.preventDefault();
                btnCopy.click();
            }
        });

        // ========== SEO Â∑•ÂÖ∑ÂäüËÉΩ ==========

        // SEO Áõ∏ÂÖ≥ DOM ÂÖÉÁ¥†
        const seoContainer = document.getElementById('seo-container');
        const mainContent = document.querySelector('.main-content');
        const optionsPanel = document.querySelector('.options');

        // Slug ÁîüÊàêÂô®ÂÖÉÁ¥†
        const slugInput = document.getElementById('slug-input');
        const slugOutput = document.getElementById('slug-output');
        const btnCopySlug = document.getElementById('btn-copy-slug');

        // ÂÆåÊï¥ URL ÂÖÉÁ¥†
        const fullUrlOutput = document.getElementById('full-url-output');
        const btnCopyFullUrl = document.getElementById('btn-copy-full-url');

        // SERP È¢ÑËßàÂÖÉÁ¥†
        const serpTitle = document.getElementById('serp-title');
        const serpUrl = document.getElementById('serp-url');
        const serpDescription = document.getElementById('serp-description');
        const titleCount = document.getElementById('title-count');
        const descCount = document.getElementById('desc-count');
        const previewTitle = document.getElementById('preview-title');
        const previewUrl = document.getElementById('preview-url');
        const previewDescription = document.getElementById('preview-description');

        // ÁÆÄÂåñÁöÑÊãºÈü≥Êò†Â∞ÑË°®ÔºàÂ∏∏Áî®Ê±âÂ≠óÔºâ
        const pinyinMap = {
            'ÁöÑ': 'de', '‰∏Ä': 'yi', 'ÊòØ': 'shi', 'Âú®': 'zai', '‰∏ç': 'bu', '‰∫Ü': 'le', 'Êúâ': 'you', 'Âíå': 'he',
            '‰∫∫': 'ren', 'Ëøô': 'zhe', '‰∏≠': 'zhong', 'Â§ß': 'da', '‰∏∫': 'wei', '‰∏ä': 'shang', '‰∏™': 'ge',
            'ÂõΩ': 'guo', 'Êàë': 'wo', '‰ª•': 'yi', 'Ë¶Å': 'yao', '‰ªñ': 'ta', 'Êó∂': 'shi', 'Êù•': 'lai',
            'Áî®': 'yong', '‰ª¨': 'men', 'Áîü': 'sheng', 'Âà∞': 'dao', '‰Ωú': 'zuo', 'Âú∞': 'di', '‰∫é': 'yu',
            'Âá∫': 'chu', 'Â∞±': 'jiu', 'ÂàÜ': 'fen', 'ÂØπ': 'dui', 'Êàê': 'cheng', '‰ºö': 'hui', 'ÂèØ': 'ke',
            '‰∏ª': 'zhu', 'Âèë': 'fa', 'Âπ¥': 'nian', 'Âä®': 'dong', 'Âêå': 'tong', 'Â∑•': 'gong', '‰πü': 'ye',
            'ËÉΩ': 'neng', '‰∏ã': 'xia', 'Ëøá': 'guo', 'Â≠ê': 'zi', 'ËØ¥': 'shuo', '‰∫ß': 'chan', 'Áßç': 'zhong',
            'Èù¢': 'mian', 'ËÄå': 'er', 'Êñπ': 'fang', 'Âêé': 'hou', 'Â§ö': 'duo', 'ÂÆö': 'ding', 'Ë°å': 'xing',
            'Â≠¶': 'xue', 'Ê≥ï': 'fa', 'ÊâÄ': 'suo', 'Ê∞ë': 'min', 'Âæó': 'de', 'Áªè': 'jing', 'ÂçÅ': 'shi',
            '‰∏â': 'san', '‰πã': 'zhi', 'Ëøõ': 'jin', 'ÁùÄ': 'zhe', 'Á≠â': 'deng', 'ÈÉ®': 'bu', 'Â∫¶': 'du',
            'ÂÆ∂': 'jia', 'Áîµ': 'dian', 'Âäõ': 'li', 'Èáå': 'li', 'Â¶Ç': 'ru', 'Ê∞¥': 'shui', 'Âåñ': 'hua',
            'È´ò': 'gao', 'Ëá™': 'zi', '‰∫å': 'er', 'ÁêÜ': 'li', 'Ëµ∑': 'qi', 'Â∞è': 'xiao', 'Áâ©': 'wu',
            'Áé∞': 'xian', 'ÂÆû': 'shi', 'Âä†': 'jia', 'Èáè': 'liang', 'ÈÉΩ': 'dou', '‰∏§': 'liang', '‰Ωì': 'ti',
            'Âà∂': 'zhi', 'Êú∫': 'ji', 'ÂΩì': 'dang', '‰Ωø': 'shi', 'ÁÇπ': 'dian', '‰ªé': 'cong', '‰∏ö': 'ye',
            'Êú¨': 'ben', 'Âéª': 'qu', 'Êää': 'ba', 'ÊÄß': 'xing', 'Â•Ω': 'hao', 'Â∫î': 'ying', 'ÂºÄ': 'kai',
            'ÂÆÉ': 'ta', 'Âêà': 'he', 'Ëøò': 'hai', 'Âõ†': 'yin', 'Áî±': 'you', 'ÂÖ∂': 'qi', '‰∫õ': 'xie',
            'ÁÑ∂': 'ran', 'Ââç': 'qian', 'Â§ñ': 'wai', 'Â§©': 'tian', 'Êîø': 'zheng', 'Âõõ': 'si', 'Êó•': 'ri',
            'ÈÇ£': 'na', 'Á§æ': 'she', '‰πâ': 'yi', '‰∫ã': 'shi', 'Âπ≥': 'ping', 'ÂΩ¢': 'xing', 'Áõ∏': 'xiang',
            'ÂÖ®': 'quan', 'Ë°®': 'biao', 'Èó¥': 'jian', 'Ê†∑': 'yang', '‰∏é': 'yu', 'ÂÖ≥': 'guan', 'ÂêÑ': 'ge',
            'Èáç': 'zhong', 'Êñ∞': 'xin', 'Á∫ø': 'xian', 'ÂÜÖ': 'nei', 'Êï∞': 'shu', 'Ê≠£': 'zheng', 'ÂøÉ': 'xin',
            'Âèç': 'fan', '‰Ω†': 'ni', 'Êòé': 'ming', 'Áúã': 'kan', 'Âéü': 'yuan', 'Âèà': 'you', '‰πà': 'me',
            'Âà©': 'li', 'ÊØî': 'bi', 'Êàñ': 'huo', '‰ΩÜ': 'dan', 'Ë¥®': 'zhi', 'Ê∞î': 'qi', 'Á¨¨': 'di',
            'Âêë': 'xiang', 'ÈÅì': 'dao', 'ÂëΩ': 'ming', 'Ê≠§': 'ci', 'Âèò': 'bian', 'Êù°': 'tiao', 'Âè™': 'zhi',
            'Ê≤°': 'mei', 'Áªì': 'jie', 'Ëß£': 'jie', 'ÈóÆ': 'wen', 'ÊÑè': 'yi', 'Âª∫': 'jian', 'Êúà': 'yue',
            'ÂÖ¨': 'gong', 'Êó†': 'wu', 'Á≥ª': 'xi', 'ÂÜõ': 'jun', 'Âæà': 'hen', 'ÊÉÖ': 'qing', 'ÊúÄ': 'zui',
            '‰Ωï': 'he', 'Âàô': 'ze', 'Â∑≤': 'yi', 'ÂÖà': 'xian', '‰ª£': 'dai', 'ÁÆó': 'suan', 'ÂÑø': 'er',
            'Êñá': 'wen', 'ÊÄª': 'zong', 'Ê¨°': 'ci', 'ÂìÅ': 'pin', 'Âºè': 'shi', 'Ê¥ª': 'huo', 'ËÆæ': 'she',
            'Âèä': 'ji', 'ÁÆ°': 'guan', 'Áâπ': 'te', '‰ª∂': 'jian', 'Èïø': 'chang', 'Ê±Ç': 'qiu', 'ËÄÅ': 'lao',
            'Â§¥': 'tou', 'Âü∫': 'ji', 'ËµÑ': 'zi', 'Ëæπ': 'bian', 'ÊµÅ': 'liu', 'Ë∑Ø': 'lu', 'Á∫ß': 'ji',
            'Â∞ë': 'shao', 'Âõæ': 'tu', 'Â±±': 'shan', 'Áªü': 'tong', 'Êé•': 'jie', 'Áü•': 'zhi', 'ËæÉ': 'jiao',
            'Â∞Ü': 'jiang', 'ÁªÑ': 'zu', 'ËßÅ': 'jian', 'ËÆ°': 'ji', 'Âà´': 'bie', 'Â•π': 'ta', 'Êâã': 'shou',
            'Ëßí': 'jiao', 'Êúü': 'qi', 'Ê†π': 'gen', 'ËÆ∫': 'lun', 'Ëøê': 'yun', 'ÂÜú': 'nong', 'Êåá': 'zhi',
            'Âá†': 'ji', '‰πù': 'jiu', 'Âå∫': 'qu', 'Âº∫': 'qiang', 'Êîæ': 'fang', 'ÂÜ≥': 'jue', 'Ë•ø': 'xi',
            'Ë¢´': 'bei', 'Âπ≤': 'gan', 'ÂÅö': 'zuo', 'ÂøÖ': 'bi', 'Êàò': 'zhan', 'ÂÖà': 'xian', 'Âõû': 'hui',
            'ÁΩë': 'wang', 'Á´ô': 'zhan', 'È°µ': 'ye', 'Êïô': 'jiao', 'Á®ã': 'cheng', 'ÊäÄ': 'ji', 'ÊúØ': 'shu',
            '‰ø°': 'xin', 'ÊÅØ': 'xi', 'ÂÆâ': 'an', 'Êúç': 'fu', 'Âä°': 'wu', 'Êï∞': 'shu', 'ÊçÆ': 'ju',
            'Â∫ì': 'ku', 'ËΩØ': 'ruan', '‰ª∂': 'jian', 'Á°¨': 'ying', 'Áõò': 'pan', 'Â≠ò': 'cun', 'ÂÇ®': 'chu',
            'ÂÜÖ': 'nei', 'Â≠ò': 'cun', 'Â§Ñ': 'chu', 'ÁêÜ': 'li', 'Âô®': 'qi', 'Êòæ': 'xian', 'Á§∫': 'shi',
            'Ëæì': 'shu', 'ÂÖ•': 'ru', 'Ëæì': 'shu', 'Âá∫': 'chu', 'Á´Ø': 'duan', 'Âè£': 'kou', 'Âçè': 'xie',
            'ËÆÆ': 'yi', '‰º†': 'chuan', 'Ëæì': 'shu', 'ÈÄü': 'su', 'Áéá': 'lv', 'Â∏¶': 'dai', 'ÂÆΩ': 'kuan',
            'Ëøû': 'lian', 'Êé•': 'jie', 'Êñ≠': 'duan', 'ÂºÄ': 'kai', 'ÂÖ≥': 'guan', 'Èó≠': 'bi', 'ÂêØ': 'qi',
            'ÂÅú': 'ting', 'Ê≠¢': 'zhi', 'Áªß': 'ji', 'Áª≠': 'xu', 'ÂÆå': 'wan', 'Êàê': 'cheng', 'Â§±': 'shi',
            'Ë¥•': 'bai', 'Èîô': 'cuo', 'ËØØ': 'wu', 'Ë≠¶': 'jing', 'Âëä': 'gao', 'Êèê': 'ti', 'ÈÜí': 'xing',
            'Ê≥®': 'zhu', 'ÊÑè': 'yi', 'Á°Æ': 'que', 'ËÆ§': 'ren', 'Âèñ': 'qu', 'Ê∂à': 'xiao', '‰øù': 'bao',
            'Â≠ò': 'cun', 'Âà†': 'shan', 'Èô§': 'chu', '‰øÆ': 'xiu', 'Êîπ': 'gai', 'Áºñ': 'bian', 'Ëæë': 'ji',
            'Â§ç': 'fu', 'Âà∂': 'zhi', 'Á≤ò': 'zhan', 'Ë¥¥': 'tie', 'Ââ™': 'jian', 'Âàá': 'qie', 'Êí§': 'che',
            'ÈîÄ': 'xiao', 'ÊÅ¢': 'hui', 'Êêú': 'sou', 'Á¥¢': 'suo', 'Êü•': 'cha', 'Êâæ': 'zhao', 'Êõø': 'ti',
            'Êç¢': 'huan', 'Êâì': 'da', 'Âç∞': 'yin', 'È¢Ñ': 'yu', 'Ëßà': 'lan', 'ÂØº': 'dao', 'Âá∫': 'chu',
            'ÂØº': 'dao', 'ÂÖ•': 'ru', '‰∏ä': 'shang', '‰º†': 'chuan', '‰∏ã': 'xia', 'ËΩΩ': 'zai', 'ÂÆâ': 'an',
            'Ë£Ö': 'zhuang', 'Âç∏': 'xie', 'ËΩΩ': 'zai', 'Êõ¥': 'geng', 'Êñ∞': 'xin', 'Âçá': 'sheng', 'Á∫ß': 'ji',
            'Áâà': 'ban', 'Êú¨': 'ben', 'Âäü': 'gong', 'ËÉΩ': 'neng', 'Ê®°': 'mo', 'Âùó': 'kuai', 'Êèí': 'cha',
            'Êâ©': 'kuo', 'Â±ï': 'zhan', 'ÈÖç': 'pei', 'ÁΩÆ': 'zhi', 'ÈÄâ': 'xuan', 'È°π': 'xiang', 'ÂèÇ': 'can',
            'Èªò': 'mo', 'ËÆ§': 'ren', 'Ëá™': 'zi', 'ÂÆö': 'ding', '‰πâ': 'yi', 'Ê†á': 'biao', 'Á≠æ': 'qian',
            'ÂàÜ': 'fen', 'Á±ª': 'lei', 'Êéí': 'pai', 'Â∫è': 'xu', 'Á≠õ': 'shai', 'ÈÄâ': 'xuan', 'Ëøá': 'guo',
            'Êª§': 'lv', 'Êòæ': 'xian', 'Èöê': 'yin', 'Ëóè': 'cang', 'Êäò': 'zhe', 'Âè†': 'die', 'Â±ï': 'zhan',
            'Êî∂': 'shou', 'Ëµ∑': 'qi', 'Êîæ': 'fang', 'Áº©': 'suo', 'ÊúÄ': 'zui', 'Á™ó': 'chuang', 'ÂÖ®': 'quan',
            'Â±è': 'ping', 'ÈÄÄ': 'tui', 'Ëøî': 'fan', 'Ë∑≥': 'tiao', 'ËΩ¨': 'zhuan', 'Èìæ': 'lian', 'Èîö': 'mao',
            '‰π¶': 'shu', 'ÂéÜ': 'li', 'Âè≤': 'shi', 'ËÆ∞': 'ji', 'ÂΩï': 'lu', 'Êó•': 'ri', 'Âøó': 'zhi',
            'Êä•': 'bao', 'Ë°®': 'biao', 'Áªü': 'tong', 'ËÆ°': 'ji', 'ÂàÜ': 'fen', 'Êûê': 'xi', 'Âõæ': 'tu',
            'Ë°®': 'biao', 'È•º': 'bing', 'Êü±': 'zhu', 'Áä∂': 'zhuang', 'Êõ≤': 'qu', 'Á∫ø': 'xian', 'Êï£': 'san',
            'ÁÇπ': 'dian', 'Èõ∑': 'lei', 'Ëææ': 'da', 'ÁÉ≠': 're', 'Âäõ': 'li', 'Ê†ë': 'shu', 'Áîò': 'gan',
            'Áâπ': 'te', '‰ª™': 'yi', 'Ë°®': 'biao', 'Áõò': 'pan', 'Ëøõ': 'jin', 'Â∫¶': 'du', 'Áôæ': 'bai',
            'ÂçÉ': 'qian', '‰∏á': 'wan', '‰∫ø': 'yi', 'Èõ∂': 'ling', '‰∫î': 'wu', 'ÂÖ≠': 'liu', '‰∏É': 'qi',
            'ÂÖ´': 'ba', 'Êòü': 'xing', 'Êúü': 'qi', 'Âë®': 'zhou', 'Êú´': 'mo', 'ÂÅá': 'jia', 'ËäÇ': 'jie',
            '‰ªä': 'jin', 'Êò®': 'zuo', 'Êòé': 'ming', 'Êó©': 'zao', 'Êôö': 'wan', 'Âçà': 'wu', 'Áßí': 'miao',
            'Èíü': 'zhong', 'Âàª': 'ke', 'Êï¥': 'zheng', 'Âçä': 'ban', 'Êò•': 'chun', 'Â§è': 'xia', 'Áßã': 'qiu',
            'ÂÜ¨': 'dong', '‰∏ú': 'dong', 'Âçó': 'nan', 'Âåó': 'bei', 'Â∑¶': 'zuo', 'Âè≥': 'you', 'Èáå': 'li',
            'Á±≥': 'mi', 'ÂÖ¨': 'gong', 'Êñ§': 'jin', 'ÂÖã': 'ke', 'Âê®': 'dun', 'Âçá': 'sheng', 'ÊØ´': 'hao',
            'Âéò': 'li', 'ÂÖÉ': 'yuan', 'Ëßí': 'jiao', 'Áæé': 'mei', 'Ê¨ß': 'ou', 'Ëã±': 'ying', 'Èïë': 'bang',
            'Èü©': 'han', 'Â∏Å': 'bi', 'Ê±á': 'hui', 'ÂÖë': 'dui', '‰ª∑': 'jia', 'Ê†º': 'ge', 'Êäò': 'zhe',
            'Êâ£': 'kou', '‰ºò': 'you', 'ÊÉ†': 'hui', '‰øÉ': 'cu', 'ÈîÄ': 'xiao', 'Èôê': 'xian', 'ÂÖç': 'mian',
            'Ë¥π': 'fei', '‰ªò': 'fu', 'Ê¨æ': 'kuan', 'ÊîØ': 'zhi', 'Êî∂': 'shou', 'ÈÄÄ': 'tui', 'ËÆ¢': 'ding',
            'Âçï': 'dan', 'Ë¥≠': 'gou', 'Áâ©': 'wu', 'ËΩ¶': 'che', 'Áªì': 'jie', 'Ë¥¶': 'zhang', 'Âèë': 'fa',
            'Á•®': 'piao', 'ÈÇÆ': 'you', 'ÂØÑ': 'ji', 'Âø´': 'kuai', 'ÈÄí': 'di', 'Áâ©': 'wu', 'Ë∑ü': 'gen',
            'Ë∏™': 'zong', 'Á≠æ': 'qian', 'Êî∂': 'shou', 'ËØÑ': 'ping', 'ËÆ∫': 'lun', 'Â•Ω': 'hao', 'ËØÑ': 'ping',
            'Â∑Æ': 'cha', 'Êòü': 'xing', 'Êé®': 'tui', 'Ëçê': 'jian', 'ÁÉ≠': 'hao', 'Èó®': 'men', 'ÁïÖ': 'chang',
            'ÈîÄ': 'xiao', 'Êéí': 'pai', 'Ë°å': 'xing', 'Ê¶ú': 'bang', 'È¶ñ': 'shou', 'Á≤æ': 'jing', 'ÈÄâ': 'xuan',
            'ÂøÖ': 'bi', '‰π∞': 'mai', 'Âçñ': 'mai', 'Áßü': 'zu', 'ÂÄü': 'jie', 'Êç¢': 'huan', 'ÈÄÅ': 'song',
            'Á§º': 'li', 'Ëµ†': 'zeng', 'ÂìÅ': 'pin', 'Ê†∑': 'yang', 'ËØï': 'shi', 'Áî®': 'yong', '‰Ωì': 'ti',
            'È™å': 'yan', 'Âèç': 'fan', 'È¶à': 'kui', 'ÂÆ¢': 'ke', 'Êà∑': 'hu', '‰ºö': 'hui', 'Âëò': 'yuan',
            'ÁßØ': 'ji', 'Á≠â': 'deng', 'ÊôÆ': 'pu', 'ÈÄö': 'tong', 'ÈªÑ': 'huang', 'Èáë': 'jin', 'ÁôΩ': 'bai',
            'Èì∂': 'yin', 'Èìú': 'tong', 'Èíª': 'zuan', 'Áü≥': 'shi', 'Áöá': 'huang', 'ÂÜ†': 'guan', 'Ëá≥': 'zhi',
            'Â∞ä': 'zun', 'Ë¥µ': 'gui', 'ÂÆæ': 'bin', '‰∏ì': 'zhuan', 'Â±û': 'shu', 'ÁßÅ': 'si', 'ÂØÜ': 'mi',
            'Áßò': 'mi', 'Áã¨': 'du', '‰∫´': 'xiang', 'ÂÆö': 'ding', 'È°∂': 'ding', 'Ë∂Ö': 'chao', 'Ë±™': 'hao',
            'Âçé': 'hua', 'Â•¢': 'she', '‰æà': 'chi', 'ÁÆÄ': 'jian', 'Á∫¶': 'yue', 'Êó∂': 'shi', 'Â∞ö': 'shang',
            'ÊΩÆ': 'chao', 'ÊµÅ': 'liu', 'Â§ç': 'fu', 'Âè§': 'gu', 'ÂÖ∏': 'dian', 'ÈõÖ': 'ya', 'Ê∏Ö': 'qing',
            'Ê£Æ': 'sen', 'Á≥ª': 'xi', 'Â∑•': 'gong', 'Âéü': 'yuan', 'Âàõ': 'chuang', 'ËÆæ': 'she', 'Â∏à': 'shi',
            'Âå†': 'jiang', 'ÈÄ†': 'zao', 'Êô∫': 'zhi', '‰∫ë': 'yun', 'Á´Ø': 'duan', 'ËÅî': 'lian', '‰∏á': 'wan',
            'Âå∫': 'qu', 'Âùó': 'kuai', 'Èìæ': 'lian', 'ÂÖÉ': 'yuan', 'ÂÆá': 'yu', 'ÂÆô': 'zhou', 'Ëôö': 'xu',
            'Êãü': 'ni', 'Áé∞': 'xian', 'ÂÆû': 'shi', 'Â¢û': 'zeng', 'Âº∫': 'qiang', 'Ê∑∑': 'hun', 'Âêà': 'he',
            'ËÑë': 'nao', 'Êé•': 'jie', 'Âè£': 'kou', 'Ê∑±': 'shen', '‰π†': 'xi', 'Á•û': 'shen', 'Áªè': 'jing',
            'ÁÆó': 'suan', 'Âç∑': 'juan', 'Âæ™': 'xun', 'ÁéØ': 'huan', 'Ê≥®': 'zhu', 'Âäõ': 'li', 'Áîü': 'sheng',
            'Êàê': 'cheng', 'ÂØπ': 'dui', 'Êäó': 'kang', 'ËøÅ': 'qian', 'Áßª': 'yi', 'ÂæÆ': 'wei', 'Ë∞É': 'tiao',
            'Êèê': 'ti', 'Á§∫': 'shi', 'ËØ≠': 'yu', 'Ë®Ä': 'yan', 'Ê®°': 'mo', 'Âûã': 'xing', 'Â§ß': 'da',
            'Âü∫': 'ji', 'Â∫ß': 'zuo', 'ÈóÆ': 'wen', 'Á≠î': 'da', 'ËÅä': 'liao', 'Âä©': 'zhu', 'ÂÜô': 'xie',
            'Áøª': 'fan', 'ËØë': 'yi', 'Êëò': 'zhai', 'Ë¶Å': 'yao', 'ÊÉÖ': 'qing', 'ÊÑü': 'gan', 'ÊÑè': 'yi',
            'Âõæ': 'tu', 'ËØÜ': 'shi', 'ÂÆû': 'shi', 'ÂëΩ': 'ming', 'Âêç': 'ming', 'Ê£Ä': 'jian', 'Êµã': 'ce',
            'ÁõÆ': 'mu', 'Ë∑ü': 'gen', 'ËØ≠': 'yu', 'Èü≥': 'yin', 'ËØÜ': 'shi', 'Âêà': 'he', 'ÂÖã': 'ke',
            'ÈöÜ': 'long', 'Âèò': 'bian', 'Â£∞': 'sheng', 'ËßÜ': 'shi', 'È¢ë': 'pin', 'Ââ™': 'jian', 'Ëæë': 'ji',
            'Áâπ': 'te', 'Êïà': 'xiao', 'Êª§': 'lv', 'Èïú': 'jing', 'Áæé': 'mei', 'È¢ú': 'yan', 'Áò¶': 'shou',
            'ËÑ∏': 'lian', 'Á£®': 'mo', 'ÁöÆ': 'pi', 'Á•õ': 'qu', 'Êñë': 'ban', '‰∫Æ': 'liang', 'Áúº': 'yan',
            'Á∫¢': 'hong', 'Âîá': 'chun', 'Ë¥¥': 'tie', 'Á∫∏': 'zhi', 'ËÉå': 'bei', 'ÊôØ': 'jing', 'Ëôö': 'xu',
            'Âåñ': 'hua', 'Êä†': 'kou', 'Âõæ': 'tu', 'ËØÅ': 'zheng', 'ÁÖß': 'zhao', 'Ë∫´': 'shen', '‰ªΩ': 'fen',
            'Êä§': 'hu', 'ÁÖß': 'zhao', 'È©æ': 'jia', 'Êâß': 'zhi', 'Á§æ': 'she', '‰øù': 'bao', 'Âç°': 'ka',
            'Èì∂': 'yin', 'Ë°å': 'xing', '‰ø°': 'xin', 'Áî®': 'yong', 'ÂÄü': 'jie', 'ÂÇ®': 'chu', 'ËìÑ': 'xu',
            'Ê¥ª': 'huo', 'ÂÆö': 'ding', 'Êúü': 'qi', 'Âà©': 'li', 'ÊÅØ': 'xi', 'Â§ç': 'fu', 'Âà©': 'li',
            'Êú¨': 'ben', 'Èáë': 'jin', 'Êî∂': 'shou', 'Áõä': 'yi', 'È£é': 'feng', 'Èô©': 'xian', 'Êäï': 'tou',
            'ËµÑ': 'zi', 'ÁêÜ': 'li', 'Ë¥¢': 'cai', 'ËÇ°': 'gu', 'Á•®': 'piao', 'Âü∫': 'ji', 'Èáë': 'jin',
            'ÂÄ∫': 'zhai', 'Âà∏': 'quan', 'Êúü': 'qi', 'Ë¥ß': 'huo', 'Â§ñ': 'wai', 'Ê±á': 'hui', 'ÈªÑ': 'huang',
            'Êàø': 'fang', '‰∫ß': 'chan', '‰øù': 'bao', 'Èô©': 'xian', 'ÂÖª': 'yang', 'ËÄÅ': 'lao', 'Âåª': 'yi',
            'Áñó': 'liao', 'ÊÑè': 'yi', 'Â§ñ': 'wai', 'Ë¥¢': 'cai', 'Èáç': 'zhong', 'Áñæ': 'ji', 'ÂØø': 'shou',
            'ËΩ¶': 'che', 'Ë¥£': 'ze', '‰ªª': 'ren', '‰∏â': 'san', 'ËÄÖ': 'zhe', 'Áõó': 'dao', 'Êä¢': 'qiang',
            'Áéª': 'bo', 'ÁíÉ': 'li', 'Âàí': 'hua', 'Áóï': 'hen', 'Ê∂â': 'she', 'Ê∞¥': 'shui', 'Ëá™': 'zi',
            'ÁáÉ': 'ran', '‰∫§': 'jiao', 'ÈÄö': 'tong', '‰∫ã': 'shi', 'ÊïÖ': 'gu', 'Ëøù': 'wei', 'Á´†': 'zhang',
            'ÁΩö': 'fa', 'Êâ£': 'kou', 'È©æ': 'jia', 'Âêä': 'diao', 'ÈîÄ': 'xiao', 'ÈÖí': 'jiu', 'È©æ': 'jia',
            'ÈÜâ': 'zui', 'Ë∂Ö': 'chao', 'ÈÄü': 'su', 'ÈóØ': 'chuang', 'ÁÅØ': 'deng', 'ÈÄÜ': 'ni', 'Ë°å': 'xing',
            'Âéã': 'ya', 'ÂÅú': 'ting', 'Èù†': 'kao', 'Êéâ': 'diao', 'Â§¥': 'tou', 'Âèò': 'bian', 'ÈÅì': 'dao',
            'Âä†': 'jia', 'Â°û': 'sai', 'Êèí': 'cha', 'Èòü': 'dui', 'Âà´': 'bie', 'Âç†': 'zhan', 'ÈÅì': 'dao'
        };

        // ÊñáÂ≠óËΩ¨ Slug
        function textToSlug(text, style) {
            if (!text) return '-';

            text = text.trim();

            switch (style) {
                case 'pinyin':
                    // ËΩ¨ÊãºÈü≥
                    let pinyin = '';
                    for (let char of text) {
                        if (pinyinMap[char]) {
                            pinyin += pinyinMap[char] + '-';
                        } else if (/[a-zA-Z0-9]/.test(char)) {
                            pinyin += char.toLowerCase();
                        } else if (/\s/.test(char)) {
                            pinyin += '-';
                        }
                        // ÂøΩÁï•ÂÖ∂‰ªñÂ≠óÁ¨¶
                    }
                    // Ê∏ÖÁêÜÂ§ö‰ΩôÁöÑÊ®™Á∫ø
                    return pinyin.replace(/-+/g, '-').replace(/^-|-$/g, '') || '-';

                case 'english':
                    // ‰ªÖ‰øùÁïôËã±ÊñáÂíåÊï∞Â≠ó
                    return text
                        .toLowerCase()
                        .replace(/[^a-z0-9\s]/g, '')
                        .replace(/\s+/g, '-')
                        .replace(/-+/g, '-')
                        .replace(/^-|-$/g, '') || '-';

                case 'encode':
                    // URL ÁºñÁ†ÅÔºà‰øùÁïôÂéüÊñáÔºâ
                    return text
                        .toLowerCase()
                        .replace(/\s+/g, '-')
                        .replace(/-+/g, '-')
                        .replace(/^-|-$/g, '');

                default:
                    return '-';
            }
        }

        // Êõ¥Êñ∞ Slug
        function updateSlug() {
            const text = slugInput.value;
            const style = document.querySelector('input[name="slug-style"]:checked').value;
            const slug = textToSlug(text, style);
            slugOutput.textContent = slug;
            updateFullUrl(slug);
        }

        // Update full URL
        const customPrefixWrapper = document.getElementById('custom-prefix-wrapper');
        const customPrefixInput = document.getElementById('custom-prefix');

        function updateFullUrl(slug) {
            if (!slug || slug === '-') {
                fullUrlOutput.textContent = '-';
                return;
            }
            const prefix = document.querySelector('input[name="url-prefix"]:checked').value;
            let fullUrl = '';
            if (prefix === 'milvus') {
                fullUrl = 'https://milvus.io/blog/' + slug + '.md';
            } else if (prefix === 'zilliz') {
                fullUrl = 'https://zilliz.com/blog/' + slug;
            } else if (prefix === 'custom') {
                const customPrefix = customPrefixInput.value.trim();
                if (customPrefix) {
                    // Ensure prefix ends with /
                    const normalizedPrefix = customPrefix.endsWith('/') ? customPrefix : customPrefix + '/';
                    fullUrl = normalizedPrefix + slug;
                } else {
                    fullUrl = slug;
                }
            }
            fullUrlOutput.textContent = fullUrl;
        }

        // Êõ¥Êñ∞ SERP È¢ÑËßà
        function updateSerpPreview() {
            const title = serpTitle.value || 'È°µÈù¢Ê†áÈ¢òÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå';
            const url = serpUrl.value || 'https://example.com';
            const description = serpDescription.value || 'È°µÈù¢ÊèèËø∞Â∞ÜÊòæÁ§∫Âú®ËøôÈáå„ÄÇGoogle ÈÄöÂ∏∏‰ºöÊòæÁ§∫Â§ßÁ∫¶ 155-160 ‰∏™Â≠óÁ¨¶ÁöÑÊèèËø∞ÂÜÖÂÆπ„ÄÇ';

            previewTitle.textContent = title;
            previewUrl.textContent = url;
            previewDescription.textContent = description;

            // Êõ¥Êñ∞Â≠óÁ¨¶ËÆ°Êï∞
            const titleLen = serpTitle.value.length;
            const descLen = serpDescription.value.length;

            titleCount.textContent = `${titleLen}/60`;
            titleCount.classList.remove('warning', 'danger');
            if (titleLen > 60) {
                titleCount.classList.add('danger');
            } else if (titleLen > 50) {
                titleCount.classList.add('warning');
            }

            descCount.textContent = `${descLen}/160`;
            descCount.classList.remove('warning', 'danger');
            if (descLen > 160) {
                descCount.classList.add('danger');
            } else if (descLen > 140) {
                descCount.classList.add('warning');
            }
        }

        // Â§çÂà∂ Slug
        btnCopySlug.addEventListener('click', async () => {
            const slug = slugOutput.textContent;
            if (slug === '-') {
                showToast('Ê≤°ÊúâÂèØÂ§çÂà∂ÁöÑÂÜÖÂÆπ');
                return;
            }
            try {
                await navigator.clipboard.writeText(slug);
                showToast('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø!');
            } catch (err) {
                showToast('Â§çÂà∂Â§±Ë¥•');
            }
        });

        // Slug ËæìÂÖ•‰∫ã‰ª∂
        slugInput.addEventListener('input', updateSlug);
        document.querySelectorAll('input[name="slug-style"]').forEach(radio => {
            radio.addEventListener('change', updateSlug);
        });

        // URL prefix selection events
        document.querySelectorAll('input[name="url-prefix"]').forEach(radio => {
            radio.addEventListener('change', () => {
                const prefix = document.querySelector('input[name="url-prefix"]:checked').value;
                if (prefix === 'custom') {
                    customPrefixWrapper.classList.remove('hidden');
                } else {
                    customPrefixWrapper.classList.add('hidden');
                }
                const slug = slugOutput.textContent;
                updateFullUrl(slug);
            });
        });

        // Custom prefix input event
        customPrefixInput.addEventListener('input', () => {
            const slug = slugOutput.textContent;
            updateFullUrl(slug);
        });

        // Â§çÂà∂ÂÆåÊï¥ URL
        btnCopyFullUrl.addEventListener('click', async () => {
            const url = fullUrlOutput.textContent;
            if (url === '-') {
                showToast('Ê≤°ÊúâÂèØÂ§çÂà∂ÁöÑÂÜÖÂÆπ');
                return;
            }
            try {
                await navigator.clipboard.writeText(url);
                showToast('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø!');
            } catch (err) {
                showToast('Â§çÂà∂Â§±Ë¥•');
            }
        });

        // SERP ËæìÂÖ•‰∫ã‰ª∂
        serpTitle.addEventListener('input', updateSerpPreview);
        serpUrl.addEventListener('input', updateSerpPreview);
        serpDescription.addEventListener('input', updateSerpPreview);

        // Êõ¥Êñ∞Ê®°ÂºèÂàáÊç¢ÈÄªËæë‰ª•ÊîØÊåÅ SEO Ê®°ÂºèÂíå QR Code Ê®°Âºè
        const qrcodeContainer = document.getElementById('qrcode-container');
        const originalModeHandler = modeTabs[0].onclick;
        modeTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const mode = tab.dataset.mode;

                if (mode === 'seo') {
                    // ÈöêËóè Markdown Áõ∏ÂÖ≥ÂÜÖÂÆπ
                    mainContent.classList.add('hidden');
                    optionsPanel.classList.add('hidden');
                    seoContainer.classList.add('active');
                    qrcodeContainer.classList.remove('active');
                } else if (mode === 'qrcode') {
                    // ÊòæÁ§∫ QR Code Â∑•ÂÖ∑
                    mainContent.classList.add('hidden');
                    optionsPanel.classList.add('hidden');
                    seoContainer.classList.remove('active');
                    qrcodeContainer.classList.add('active');
                } else {
                    // ÊòæÁ§∫ Markdown Áõ∏ÂÖ≥ÂÜÖÂÆπ
                    mainContent.classList.remove('hidden');
                    optionsPanel.classList.remove('hidden');
                    seoContainer.classList.remove('active');
                    qrcodeContainer.classList.remove('active');
                }
            });
        });

        // ========== QR Code Generator ==========

        // QR Code DOM Elements
        const qrLogoInput = document.getElementById('qr-logo');
        const logoUploadArea = document.getElementById('logo-upload-area');
        const logoPlaceholder = document.getElementById('logo-placeholder');
        const logoPreview = document.getElementById('logo-preview');
        const logoPreviewImg = document.getElementById('logo-preview-img');
        const removeLogo = document.getElementById('remove-logo');
        const batchItems = document.getElementById('batch-items');
        const btnAddItem = document.getElementById('btn-add-item');
        const qrPreviewGrid = document.getElementById('qr-preview-grid');
        const btnDownloadAllPng = document.getElementById('btn-download-all-png');
        const btnDownloadAllZip = document.getElementById('btn-download-all-zip');

        let currentLogoData = null;
        let currentLogoImg = null;
        let qrItems = [{ url: '', text: '' }];
        const MAX_ITEMS = 10;

        // Logo Upload Handling
        logoUploadArea.addEventListener('click', () => {
            qrLogoInput.click();
        });

        logoUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            logoUploadArea.classList.add('dragover');
        });

        logoUploadArea.addEventListener('dragleave', () => {
            logoUploadArea.classList.remove('dragover');
        });

        logoUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            logoUploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleLogoFile(files[0]);
            }
        });

        qrLogoInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleLogoFile(e.target.files[0]);
            }
        });

        function handleLogoFile(file) {
            // Validate file type
            const validTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/svg+xml'];
            if (!validTypes.includes(file.type)) {
                showToast('Please upload PNG, JPEG, or SVG file');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                currentLogoData = e.target.result;
                logoPreviewImg.src = currentLogoData;
                logoPlaceholder.classList.add('hidden');
                logoPreview.classList.remove('hidden');

                // Preload logo image
                currentLogoImg = new Image();
                currentLogoImg.src = currentLogoData;
                currentLogoImg.onload = () => {
                    updateAllQrCodes();
                };
            };
            reader.readAsDataURL(file);
        }

        removeLogo.addEventListener('click', (e) => {
            e.stopPropagation();
            currentLogoData = null;
            currentLogoImg = null;
            qrLogoInput.value = '';
            logoPlaceholder.classList.remove('hidden');
            logoPreview.classList.add('hidden');
            updateAllQrCodes();
        });

        // Batch Item Management
        btnAddItem.addEventListener('click', () => {
            if (qrItems.length >= MAX_ITEMS) {
                showToast(`Maximum ${MAX_ITEMS} items allowed`);
                return;
            }
            qrItems.push({ url: '', text: '' });
            renderBatchItems();
            renderPreviewGrid();
        });

        function renderBatchItems() {
            batchItems.innerHTML = qrItems.map((item, index) => `
                <div class="batch-item" data-index="${index}">
                    <div class="batch-item-header">
                        <span class="batch-item-number">#${index + 1}</span>
                        ${qrItems.length > 1 ? `<button class="btn-remove-item" data-index="${index}" title="Remove">&times;</button>` : ''}
                    </div>
                    <input type="url" class="seo-input qr-url-input" placeholder="https://example.com" data-index="${index}" value="${item.url}">
                    <input type="text" class="seo-input qr-text-input" placeholder="Text label (e.g., Follow us on X)" data-index="${index}" value="${item.text}">
                </div>
            `).join('');

            // Add event listeners
            batchItems.querySelectorAll('.qr-url-input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const idx = parseInt(e.target.dataset.index);
                    qrItems[idx].url = e.target.value;
                    updateSingleQrCode(idx);
                });
            });

            batchItems.querySelectorAll('.qr-text-input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const idx = parseInt(e.target.dataset.index);
                    qrItems[idx].text = e.target.value;
                    updateSingleQrCode(idx);
                });
            });

            batchItems.querySelectorAll('.btn-remove-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const idx = parseInt(e.target.dataset.index);
                    qrItems.splice(idx, 1);
                    renderBatchItems();
                    renderPreviewGrid();
                });
            });
        }

        function renderPreviewGrid() {
            qrPreviewGrid.innerHTML = qrItems.map((item, index) => `
                <div class="qr-card-wrapper" data-index="${index}">
                    <div class="qr-card">
                        <div class="qr-card-inner">
                            <div class="qr-code-container" id="qr-code-display-${index}">
                                <div class="qr-placeholder">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1.5">
                                        <rect x="3" y="3" width="7" height="7"></rect>
                                        <rect x="14" y="3" width="7" height="7"></rect>
                                        <rect x="3" y="14" width="7" height="7"></rect>
                                        <rect x="14" y="14" width="3" height="3"></rect>
                                        <rect x="18" y="14" width="3" height="3"></rect>
                                        <rect x="14" y="18" width="3" height="3"></rect>
                                        <rect x="18" y="18" width="3" height="3"></rect>
                                    </svg>
                                    <p>Enter URL</p>
                                </div>
                            </div>
                            <div class="qr-logo-overlay" id="qr-logo-overlay-${index}"></div>
                        </div>
                        <div class="qr-card-footer">
                            <span class="qr-text" id="qr-text-${index}">${item.text || ''}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            updateAllQrCodes();
        }

        function updateAllQrCodes() {
            qrItems.forEach((_, index) => {
                updateSingleQrCode(index);
            });
            updateDownloadButtons();
        }

        function updateSingleQrCode(index) {
            const item = qrItems[index];
            const container = document.getElementById(`qr-code-display-${index}`);
            const textSpan = document.getElementById(`qr-text-${index}`);
            const logoOverlay = document.getElementById(`qr-logo-overlay-${index}`);

            if (!container) return;

            // Update text
            if (textSpan) {
                textSpan.textContent = item.text || '';
            }

            // Validate URL
            if (!item.url) {
                container.innerHTML = `
                    <div class="qr-placeholder">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1.5">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                            <rect x="14" y="14" width="3" height="3"></rect>
                            <rect x="18" y="14" width="3" height="3"></rect>
                            <rect x="14" y="18" width="3" height="3"></rect>
                            <rect x="18" y="18" width="3" height="3"></rect>
                        </svg>
                        <p>Enter URL</p>
                    </div>
                `;
                if (logoOverlay) {
                    logoOverlay.classList.remove('visible');
                    logoOverlay.innerHTML = '';
                }
                updateDownloadButtons();
                return;
            }

            try {
                new URL(item.url);
            } catch (e) {
                container.innerHTML = `
                    <div class="qr-placeholder">
                        <p style="color: #dc3545;">Invalid URL</p>
                    </div>
                `;
                if (logoOverlay) {
                    logoOverlay.classList.remove('visible');
                    logoOverlay.innerHTML = '';
                }
                updateDownloadButtons();
                return;
            }

            // Generate QR Code
            const typeNumber = 0;
            const errorCorrectionLevel = currentLogoData ? 'H' : 'M';
            const qr = qrcode(typeNumber, errorCorrectionLevel);
            qr.addData(item.url);
            qr.make();

            const moduleCount = qr.getModuleCount();
            const cellSize = 4;
            const margin = 2;
            const size = moduleCount * cellSize + margin * 2 * cellSize;

            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');

            // Draw white background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, size, size);

            // Draw QR code modules (black)
            ctx.fillStyle = '#000000';
            for (let row = 0; row < moduleCount; row++) {
                for (let col = 0; col < moduleCount; col++) {
                    if (qr.isDark(row, col)) {
                        const x = (col + margin) * cellSize;
                        const y = (row + margin) * cellSize;
                        ctx.fillRect(x, y, cellSize, cellSize);
                    }
                }
            }

            // Draw logo on canvas if exists
            if (currentLogoImg && currentLogoImg.complete) {
                const logoSize = size * 0.22;
                const logoX = (size - logoSize) / 2;
                const logoY = (size - logoSize) / 2;

                // White background for logo
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(logoX - 3, logoY - 3, logoSize + 6, logoSize + 6);

                // Draw logo
                ctx.drawImage(currentLogoImg, logoX, logoY, logoSize, logoSize);
            }

            container.innerHTML = '';
            canvas.style.borderRadius = '8px';
            container.appendChild(canvas);

            // Show logo overlay for visual effect
            if (logoOverlay) {
                if (currentLogoData) {
                    logoOverlay.innerHTML = `<img src="${currentLogoData}" alt="Logo">`;
                    logoOverlay.classList.add('visible');
                } else {
                    logoOverlay.classList.remove('visible');
                    logoOverlay.innerHTML = '';
                }
            }

            updateDownloadButtons();
        }

        function updateDownloadButtons() {
            const hasValidQr = qrItems.some(item => {
                if (!item.url) return false;
                try {
                    new URL(item.url);
                    return true;
                } catch (e) {
                    return false;
                }
            });
            btnDownloadAllPng.disabled = !hasValidQr;
            btnDownloadAllZip.disabled = !hasValidQr;
        }

        // Download Functions
        btnDownloadAllPng.addEventListener('click', () => {
            downloadAllAsPng();
        });

        btnDownloadAllZip.addEventListener('click', () => {
            downloadAllAsZip();
        });

        function createExportCanvas(item, index) {
            if (!item.url) return null;
            try {
                new URL(item.url);
            } catch (e) {
                return null;
            }

            // Generate QR Code
            const typeNumber = 0;
            const errorCorrectionLevel = currentLogoData ? 'H' : 'M';
            const qr = qrcode(typeNumber, errorCorrectionLevel);
            qr.addData(item.url);
            qr.make();

            const moduleCount = qr.getModuleCount();
            const cellSize = 8;
            const margin = 2;
            const qrSize = moduleCount * cellSize + margin * 2 * cellSize;

            // Card dimensions - tight padding like reference
            const cardPadding = 16;
            const innerPadding = 12;
            const borderWidth = 4;
            const innerBoxSize = qrSize + innerPadding * 2 + borderWidth * 2;
            const cardWidth = innerBoxSize + cardPadding * 2;
            const textHeight = item.text ? 56 : 20;
            const cardHeight = innerBoxSize + cardPadding + 8 + textHeight;

            const canvas = document.createElement('canvas');
            canvas.width = cardWidth;
            canvas.height = cardHeight;
            const ctx = canvas.getContext('2d');

            // Draw diagonal gradient background (135deg) - exact match
            const gradient = ctx.createLinearGradient(0, 0, cardWidth, cardHeight);
            gradient.addColorStop(0, '#ffffff');
            gradient.addColorStop(0.15, '#f0f4f8');
            gradient.addColorStop(0.4, '#0a1628');
            gradient.addColorStop(0.6, '#0f2847');
            gradient.addColorStop(1, '#2563eb');
            ctx.fillStyle = gradient;

            // Draw rounded rectangle for card
            const radius = 20;
            ctx.beginPath();
            ctx.moveTo(radius, 0);
            ctx.lineTo(cardWidth - radius, 0);
            ctx.quadraticCurveTo(cardWidth, 0, cardWidth, radius);
            ctx.lineTo(cardWidth, cardHeight - radius);
            ctx.quadraticCurveTo(cardWidth, cardHeight, cardWidth - radius, cardHeight);
            ctx.lineTo(radius, cardHeight);
            ctx.quadraticCurveTo(0, cardHeight, 0, cardHeight - radius);
            ctx.lineTo(0, radius);
            ctx.quadraticCurveTo(0, 0, radius, 0);
            ctx.closePath();
            ctx.fill();

            // Inner box position
            const innerX = cardPadding;
            const innerY = cardPadding;
            const innerWidth = innerBoxSize;
            const innerHeight = innerBoxSize;

            // Draw black border for inner box
            ctx.fillStyle = '#000000';
            const borderRadius = 14;
            ctx.beginPath();
            ctx.moveTo(innerX + borderRadius, innerY);
            ctx.lineTo(innerX + innerWidth - borderRadius, innerY);
            ctx.quadraticCurveTo(innerX + innerWidth, innerY, innerX + innerWidth, innerY + borderRadius);
            ctx.lineTo(innerX + innerWidth, innerY + innerHeight - borderRadius);
            ctx.quadraticCurveTo(innerX + innerWidth, innerY + innerHeight, innerX + innerWidth - borderRadius, innerY + innerHeight);
            ctx.lineTo(innerX + borderRadius, innerY + innerHeight);
            ctx.quadraticCurveTo(innerX, innerY + innerHeight, innerX, innerY + innerHeight - borderRadius);
            ctx.lineTo(innerX, innerY + borderRadius);
            ctx.quadraticCurveTo(innerX, innerY, innerX + borderRadius, innerY);
            ctx.closePath();
            ctx.fill();

            // Draw white inner box
            ctx.fillStyle = '#ffffff';
            const whiteX = innerX + borderWidth;
            const whiteY = innerY + borderWidth;
            const whiteWidth = innerWidth - borderWidth * 2;
            const whiteHeight = innerHeight - borderWidth * 2;
            const whiteRadius = borderRadius - 3;
            ctx.beginPath();
            ctx.moveTo(whiteX + whiteRadius, whiteY);
            ctx.lineTo(whiteX + whiteWidth - whiteRadius, whiteY);
            ctx.quadraticCurveTo(whiteX + whiteWidth, whiteY, whiteX + whiteWidth, whiteY + whiteRadius);
            ctx.lineTo(whiteX + whiteWidth, whiteY + whiteHeight - whiteRadius);
            ctx.quadraticCurveTo(whiteX + whiteWidth, whiteY + whiteHeight, whiteX + whiteWidth - whiteRadius, whiteY + whiteHeight);
            ctx.lineTo(whiteX + whiteRadius, whiteY + whiteHeight);
            ctx.quadraticCurveTo(whiteX, whiteY + whiteHeight, whiteX, whiteY + whiteHeight - whiteRadius);
            ctx.lineTo(whiteX, whiteY + whiteRadius);
            ctx.quadraticCurveTo(whiteX, whiteY, whiteX + whiteRadius, whiteY);
            ctx.closePath();
            ctx.fill();

            // Draw QR code (black)
            const qrX = whiteX + innerPadding;
            const qrY = whiteY + innerPadding;

            ctx.fillStyle = '#000000';
            for (let row = 0; row < moduleCount; row++) {
                for (let col = 0; col < moduleCount; col++) {
                    if (qr.isDark(row, col)) {
                        const x = qrX + (col + margin) * cellSize;
                        const y = qrY + (row + margin) * cellSize;
                        ctx.fillRect(x, y, cellSize, cellSize);
                    }
                }
            }

            // Draw logo if exists
            if (currentLogoImg && currentLogoImg.complete) {
                const logoSize = qrSize * 0.22;
                const logoX = qrX + (qrSize - logoSize) / 2;
                const logoY = qrY + (qrSize - logoSize) / 2;

                ctx.fillStyle = '#ffffff';
                ctx.fillRect(logoX - 4, logoY - 4, logoSize + 8, logoSize + 8);
                ctx.drawImage(currentLogoImg, logoX, logoY, logoSize, logoSize);
            }

            // Draw text
            if (item.text) {
                ctx.fillStyle = '#ffffff';
                ctx.font = '500 18px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.text, cardWidth / 2, innerY + innerHeight + 38, cardWidth - 24);
            }

            return canvas;
        }

        function downloadAllAsPng() {
            qrItems.forEach((item, index) => {
                const canvas = createExportCanvas(item, index);
                if (canvas) {
                    const link = document.createElement('a');
                    const filename = item.text ? item.text.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 30) : `qrcode_${index + 1}`;
                    link.download = `${filename}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                }
            });
            showToast('PNG files downloaded!');
        }

        async function downloadAllAsZip() {
            // Simple ZIP implementation using data URLs
            const files = [];
            qrItems.forEach((item, index) => {
                const canvas = createExportCanvas(item, index);
                if (canvas) {
                    const filename = item.text ? item.text.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 30) : `qrcode_${index + 1}`;
                    files.push({
                        name: `${filename}.png`,
                        data: canvas.toDataURL('image/png')
                    });
                }
            });

            if (files.length === 0) {
                showToast('No valid QR codes to download');
                return;
            }

            // If only one file, just download it
            if (files.length === 1) {
                const link = document.createElement('a');
                link.download = files[0].name;
                link.href = files[0].data;
                link.click();
                showToast('PNG downloaded!');
                return;
            }

            // For multiple files, download them sequentially
            files.forEach((file, i) => {
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.download = file.name;
                    link.href = file.data;
                    link.click();
                }, i * 200);
            });
            showToast(`${files.length} PNG files downloaded!`);
        }

        // Initialize
        renderBatchItems();
        renderPreviewGrid();
    </script>
</body>
</html>
